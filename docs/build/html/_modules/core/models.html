
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>core.models &#8212; sbmOpenMM 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for core.models</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># coding: utf-8</span>

<span class="c1"># In[1]:</span>


<span class="kn">from</span> <span class="nn">simtk.openmm.app</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">simtk.openmm</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">simtk</span> <span class="k">import</span> <span class="n">unit</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">.system</span> <span class="k">import</span> <span class="n">system</span>


<span class="c1"># In[ ]:</span>


<div class="viewcode-block" id="models"><a class="viewcode-back" href="../../index.html#core.models.models">[docs]</a><span class="k">class</span> <span class="nc">models</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to hold functions for the automated generation of default SBM models.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    getAllAtomModel(pdb_file, contact_file, kwarg**)</span>
<span class="sd">        Creates an all atom SBM system class object with default initialized</span>
<span class="sd">        parameters.</span>
<span class="sd">    getCAModel(pdb_file, contact_file, kwarg**)</span>
<span class="sd">        Creates an alpha-carbon only sbmOpenMM system class object with default </span>
<span class="sd">        initialized parameters.</span>
<span class="sd">    getMultiBasinModel(main_model, alternate_configuration, kwarg**)</span>
<span class="sd">        Creates a multi basin model from two sbmOpenMM.system class instances.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
<div class="viewcode-block" id="models.getAllAtomModel"><a class="viewcode-back" href="../../index.html#core.models.models.getAllAtomModel">[docs]</a>    <span class="k">def</span> <span class="nf">getAllAtomModel</span><span class="p">(</span><span class="n">pdb_file</span><span class="p">,</span> <span class="n">contact_file</span><span class="p">,</span> 
                        <span class="n">default_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                        <span class="n">default_forces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                        <span class="n">group_by_bb_and_sc</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">create_system</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">minimise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialises a default full-heavy-atom sbmOpenMM system class from a PDB file and a contact</span>
<span class="sd">        file defining the native contacts for the model. The system creation steps are:</span>
<span class="sd">        </span>
<span class="sd">        1) Add the geometrical parameters for the model.</span>
<span class="sd">        2) Add the default force field parameters for the model.</span>
<span class="sd">        3) Create the default force objects.</span>
<span class="sd">        4) Create the OpenMM system class.</span>
<span class="sd">        </span>
<span class="sd">        The method can be used to generate an initialized sbmOpenMM system class, that only </span>
<span class="sd">        contains the geometrical parameters, by passing the option default_parameters as False.</span>
<span class="sd">        This is useful to store the geometrical values of bonds, angles, dihedrals, etc. in </span>
<span class="sd">        order to add custom parameters and forces.</span>
<span class="sd">        </span>
<span class="sd">        The method can also be created without the initialisation of the forces classes by </span>
<span class="sd">        setting default_forces to False. This allows to load the default forcefield parameters </span>
<span class="sd">        and to modified them before creating the OpenMM force objects.</span>
<span class="sd">        </span>
<span class="sd">        Finally, the method can be stopped before creating the OpenMM system class using create_system=False.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pdb_file : string</span>
<span class="sd">            Path to the input PDB file.</span>
<span class="sd">        contact_file : string</span>
<span class="sd">            Path to the input native contact file. The file can be an output </span>
<span class="sd">            from the SMOG program (4 column contact file) or a two column file </span>
<span class="sd">            defining the atoms to be paired.</span>
<span class="sd">        default_parameters : boolean (True)</span>
<span class="sd">            Whether to add default SBM All Atom forcefield parameters to the model.</span>
<span class="sd">        default_forces : boolean (True)</span>
<span class="sd">            Whether to initilize default SBM All Atom force objects. Set to False if</span>
<span class="sd">            the parameters will be different from the default ones.</span>
<span class="sd">        group_by_bb_and_sc : boolean (True)</span>
<span class="sd">            Wether to classify the torsions into backbone and side-chain to partition </span>
<span class="sd">            the torsional energy for each torsion in the system.</span>
<span class="sd">        create_system : boolean (True)</span>
<span class="sd">            If True the function will call the createSystemObject() method</span>
<span class="sd">            to create an OpenMM system object. If modifications to the default </span>
<span class="sd">            forcefield are necessary this option should be given False.</span>
<span class="sd">        minimise : boolean (False)</span>
<span class="sd">            Whether to minimise the system (with default options) if large</span>
<span class="sd">            forces are found.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sbm : sbmOpenMM.system</span>
<span class="sd">            Initializes a sbmOpenMM.system class with default options for </span>
<span class="sd">            defining an All Atom SBM force field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Generating AA SBM for PDB file &#39;</span><span class="o">+</span><span class="n">pdb_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        <span class="c1">#Set up geometric parameters of the model</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Setting up geometrical parameters:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;_________________________________&#39;</span><span class="p">)</span>
        
        <span class="n">sbm</span> <span class="o">=</span> <span class="n">system</span><span class="p">(</span><span class="n">pdb_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Removing hydrogens from topology&#39;</span><span class="p">)</span>
        <span class="n">sbm</span><span class="o">.</span><span class="n">removeHydrogens</span><span class="p">()</span>
        <span class="n">sbm</span><span class="o">.</span><span class="n">getAtoms</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sbm</span><span class="o">.</span><span class="n">n_atoms</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; atoms&#39;</span><span class="p">)</span>
        <span class="n">sbm</span><span class="o">.</span><span class="n">getBonds</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sbm</span><span class="o">.</span><span class="n">n_bonds</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; bonds&#39;</span><span class="p">)</span>
        <span class="n">sbm</span><span class="o">.</span><span class="n">getAngles</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sbm</span><span class="o">.</span><span class="n">n_angles</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; angles&#39;</span><span class="p">)</span>
        <span class="n">sbm</span><span class="o">.</span><span class="n">getProperTorsions</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sbm</span><span class="o">.</span><span class="n">n_torsions</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; torsions&#39;</span><span class="p">)</span>
        <span class="n">sbm</span><span class="o">.</span><span class="n">getImpropers</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sbm</span><span class="o">.</span><span class="n">n_impropers</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; impropers&#39;</span><span class="p">)</span>
        <span class="n">sbm</span><span class="o">.</span><span class="n">getPlanars</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sbm</span><span class="o">.</span><span class="n">n_planars</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; planars&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">contact_file</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading contacts from contact file: &#39;</span><span class="o">+</span><span class="n">contact_file</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">readContactFile</span><span class="p">(</span><span class="n">contact_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sbm</span><span class="o">.</span><span class="n">n_contacts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; native contacts&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        <span class="c1">#Add default parameters to each interaction term</span>
        <span class="k">if</span> <span class="n">default_parameters</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Setting up default forcefield parameters:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;________________________________________&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding default bond parameters:&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">setBondParameters</span><span class="p">(</span><span class="mf">10000.0</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding default angle parameters:&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">setAngleParameters</span><span class="p">(</span><span class="mf">80.0</span><span class="p">)</span>
            <span class="c1">#Get default torsion parameters</span>
            <span class="k">if</span> <span class="n">group_by_bb_and_sc</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;grouping torsions in backbone and side-chain groups:&#39;</span><span class="p">)</span>
            <span class="n">torsion_parameters</span> <span class="o">=</span> <span class="n">sbm</span><span class="o">.</span><span class="n">getAATorsionParameters</span><span class="p">(</span><span class="n">group_by_bb_and_sc</span><span class="o">=</span><span class="n">group_by_bb_and_sc</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding default torsion parameters:&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">setProperTorsionParameters</span><span class="p">(</span><span class="n">torsion_parameters</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding default improper parameters:&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">setImproperParameters</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding default planar parameters:&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">setPlanarParameters</span><span class="p">(</span><span class="mf">20.0</span><span class="p">)</span>
            <span class="c1">#Get default contact parameters</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding default contact parameters:&#39;</span><span class="p">)</span>
            <span class="n">contact_parameters</span> <span class="o">=</span> <span class="n">sbm</span><span class="o">.</span><span class="n">getAANativeContactParameters</span><span class="p">()</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">setNativeContactParameters</span><span class="p">(</span><span class="n">contact_parameters</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1">#Create default system force objects</span>
        <span class="k">if</span> <span class="n">default_parameters</span> <span class="ow">and</span> <span class="n">default_forces</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Forces:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;_____________&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Harmonic Bond Forces&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">addHarmonicBondForces</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Harmonic Angle Forces&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">addHarmonicAngleForces</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Periodic Torsion Forces&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">addPeriodicTorsionForces</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Harmonic Improper Forces&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">addHarmonicImproperForces</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Periodic Planar Forces&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">addHarmonicPlanarForces</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Lennard Jones 12-6 Forces to native contacts&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">addLJ12_6ContactForces</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Lennard Jones 12 non-bonded Forces&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">addLJRepulsionForces</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1">#Generate the system object and add previously generated forces</span>
        <span class="k">if</span> <span class="n">default_parameters</span> <span class="ow">and</span> <span class="n">default_forces</span> <span class="ow">and</span> <span class="n">create_system</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating System Object:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;______________________&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">createSystemObject</span><span class="p">(</span><span class="n">minimise</span><span class="o">=</span><span class="n">minimise</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sbm</span></div>

<div class="viewcode-block" id="models.getCAModel"><a class="viewcode-back" href="../../index.html#core.models.models.getCAModel">[docs]</a>    <span class="k">def</span> <span class="nf">getCAModel</span><span class="p">(</span><span class="n">pdb_file</span><span class="p">,</span> <span class="n">contact_file</span><span class="p">,</span> 
                   <span class="n">default_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                   <span class="n">default_forces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                   <span class="n">create_system</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                   <span class="n">contact_force</span><span class="o">=</span><span class="s1">&#39;12-10&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialises a coarse-grained, carbon alpha (CA), sbmOpenMM system class </span>
<span class="sd">        from a PDB file and a contact file defining the native contacts for the </span>
<span class="sd">        coarse grained model.</span>
<span class="sd">        </span>
<span class="sd">        The system creation steps are:</span>
<span class="sd">        </span>
<span class="sd">        1) Add the geometrical parameters for the model.</span>
<span class="sd">        2) Add the default force field parameters for the model.</span>
<span class="sd">        3) Create the default force objects.</span>
<span class="sd">        4) Create the OpenMM system class.</span>
<span class="sd">        </span>
<span class="sd">        The method can be used to generate an initialized sbmOpenMM system class, that only </span>
<span class="sd">        contains the geometrical parameters, by passing the option default_parameters as False.</span>
<span class="sd">        This is useful to store the geometrical values of bonds, angles, dihedrals, etc. in </span>
<span class="sd">        order to add custom parameters and forces.</span>
<span class="sd">        </span>
<span class="sd">        The method can also be created without the initialisation of the forces classes by </span>
<span class="sd">        setting default_forces to False. This allows to load the default forcefield parameters </span>
<span class="sd">        and to modified them before creating the OpenMM force objects.</span>
<span class="sd">        </span>
<span class="sd">        Finally, the method can be stopped before creating the OpenMM system class using create_system=False.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pdb_file : string</span>
<span class="sd">            Path to the input PDB file.</span>
<span class="sd">        contact_file : string</span>
<span class="sd">            Path to the input native contact file. The file can be an output </span>
<span class="sd">            from the SMOG program (4 column contact file) or a two column file </span>
<span class="sd">            defining the atoms to be paired.</span>
<span class="sd">        default_parameters : boolean (True)</span>
<span class="sd">            Whether to add default SBM CA forcefield parameters to the model.</span>
<span class="sd">        default_forces : boolean (True)</span>
<span class="sd">            Whether to initilize default SBM CA force objects. Set to False if</span>
<span class="sd">            the parameters will be different from the default ones.</span>
<span class="sd">        create_system : boolean (True)</span>
<span class="sd">            If True the function will call the createSystemObject() method</span>
<span class="sd">            to create an OpenMM system object. If modifications to the default </span>
<span class="sd">            forcefield are necessary this option should be given False.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sbm : sbmOpenMM.system</span>
<span class="sd">            Initialized sbmOpenMM.system class with default options for defining </span>
<span class="sd">            a coarse-grained CA SBM force field.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Generating CA SBM for PDB file &#39;</span><span class="o">+</span><span class="n">pdb_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="c1">#Set up geometric parameters of the model</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Setting up geometrical parameters:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;_________________________________&#39;</span><span class="p">)</span>
        <span class="n">sbm</span> <span class="o">=</span> <span class="n">system</span><span class="p">(</span><span class="n">pdb_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Keeping only carbon alpha atoms in topology&#39;</span><span class="p">)</span>
        <span class="n">sbm</span><span class="o">.</span><span class="n">getCAlphaOnly</span><span class="p">()</span>
        <span class="n">sbm</span><span class="o">.</span><span class="n">getAtoms</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sbm</span><span class="o">.</span><span class="n">n_atoms</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; CA atoms&#39;</span><span class="p">)</span>
        <span class="n">sbm</span><span class="o">.</span><span class="n">getBonds</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sbm</span><span class="o">.</span><span class="n">n_bonds</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; bonds&#39;</span><span class="p">)</span>
        <span class="n">sbm</span><span class="o">.</span><span class="n">getAngles</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sbm</span><span class="o">.</span><span class="n">n_angles</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; angles&#39;</span><span class="p">)</span>
        <span class="n">sbm</span><span class="o">.</span><span class="n">getProperTorsions</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sbm</span><span class="o">.</span><span class="n">n_torsions</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; torsions&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">contact_file</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading contacts from contact file: &#39;</span><span class="o">+</span><span class="n">contact_file</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">readContactFile</span><span class="p">(</span><span class="n">contact_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sbm</span><span class="o">.</span><span class="n">n_contacts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; native contacts&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        
        <span class="c1">#Add default parameters to each interaction term</span>
        <span class="k">if</span> <span class="n">default_parameters</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Setting up default forcefield parameters:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;________________________________________&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding default bond parameters:&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">setBondParameters</span><span class="p">(</span><span class="mf">20000.0</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding default angle parameters:&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">setAngleParameters</span><span class="p">(</span><span class="mf">40.0</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding default torsion parameters:&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">setProperTorsionParameters</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding default contact parameters:&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">setNativeContactParameters</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            
        <span class="c1">#Create default system force objects</span>
        <span class="k">if</span> <span class="n">default_forces</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Forces:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;_____________&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">addHarmonicBondForces</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added Harmonic Bond Forces&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">addHarmonicAngleForces</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added Harmonic Angle Forces&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">addPeriodicTorsionForces</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added Periodic Torsion Forces&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">contact_force</span> <span class="o">==</span> <span class="s1">&#39;12-10&#39;</span><span class="p">:</span>
                <span class="n">sbm</span><span class="o">.</span><span class="n">addLJ12_10ContactForces</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added Lennard Jones 12-10 Forces to native contacts&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">contact_force</span> <span class="o">==</span> <span class="s1">&#39;12-10-6&#39;</span><span class="p">:</span>
                <span class="n">sbm</span><span class="o">.</span><span class="n">addLJ12_10_6ContactForces</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added Lennard Jones 12-10-6 Forces to native contacts&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Wrong contact_force option, valid options are &quot;12-10&quot; and &quot;12-10-6&quot;&#39;</span><span class="p">)</span>
                
            <span class="n">sbm</span><span class="o">.</span><span class="n">addLJRepulsionForces</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Added Lennard Jones 12 non-bonded Forces&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            
        <span class="c1">#Generate the system object and add previously generated forces</span>
        <span class="k">if</span> <span class="n">create_system</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating System Object:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;______________________&#39;</span><span class="p">)</span>
            <span class="n">sbm</span><span class="o">.</span><span class="n">createSystemObject</span><span class="p">(</span><span class="n">minimise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">check_bond_distances</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;OpenMM system Object created&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">sbm</span></div>
    
<div class="viewcode-block" id="models.getMultiBasinModel"><a class="viewcode-back" href="../../index.html#core.models.models.getMultiBasinModel">[docs]</a>    <span class="k">def</span> <span class="nf">getMultiBasinModel</span><span class="p">(</span><span class="n">main_model</span><span class="p">,</span> <span class="n">alternate_configuration</span><span class="p">,</span> 
                                       <span class="n">double_minima_threshold</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> 
                                       <span class="n">excluded_volume_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                       <span class="n">use_lennard_jones</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                       <span class="n">create_system</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a multibasin model from two sbmOpenMM initialized system classes.</span>
<span class="sd">        It currently supports only two configurations.</span>
<span class="sd">        </span>
<span class="sd">        The two configurations (main and alternate) are compared at the level of </span>
<span class="sd">        native contacts to define common and unique contacts. If any common contact</span>
<span class="sd">        is defined to have equilibrium distances significantly different between the </span>
<span class="sd">        configurations, a multi basin Gaussian potential is added to explicitely consider </span>
<span class="sd">        both equilibrium distances in the non-bonded energy function. Unique contacts </span>
<span class="sd">        from the alternate configuration are added to the main configuration. All other</span>
<span class="sd">        bonded parameters are maintained from the main configuration.</span>
<span class="sd">        </span>
<span class="sd">        Optionally, an excluded volume term can be given, with the excluded_volume_radius</span>
<span class="sd">        option, to control separately the sphere radius from the equilibrium contact distances.</span>
<span class="sd">        </span>
<span class="sd">        The set of single-basin (or unique) contacts are added, by default, as Lennard-Jones</span>
<span class="sd">        potentials (use_lennard_jones=True) or can be added as Gaussian terms (use_lennard_jones=False)</span>
<span class="sd">        with separate control of the excluded volume term.</span>
<span class="sd">        </span>
<span class="sd">        Finally, the method can be stopped before creating the OpenMM system class using</span>
<span class="sd">        create_system=False.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        main_model : sbmOpenMM.system</span>
<span class="sd">            Configuration upon which the multi basin forces should be added.</span>
<span class="sd">        alternate_configuration : sbmOpenMM.system</span>
<span class="sd">            Second configuration to define as a new minima in the native contact force</span>
<span class="sd">            object.</span>
<span class="sd">        double_minima_threshold : float</span>
<span class="sd">            The minimum equilibrium distance difference to consider a native contact having </span>
<span class="sd">            two different equilibrium distances. If shared contacts between the configurations </span>
<span class="sd">            have equilibrium distances that do not differ more than this value, only the main </span>
<span class="sd">            configuration equilibrium distance will be  kept.</span>
<span class="sd">        excluded_volume_radius : float</span>
<span class="sd">            Radius of the excluded volume term in the Gaussian native-contact energy function.</span>
<span class="sd">        use_lennard_jones : boolean (True)</span>
<span class="sd">            Whether to use or not Lennard-Jones potential for the single-basin native contact</span>
<span class="sd">            set. If False a Gaussian function with separate control of the excluded volume term.</span>
<span class="sd">        create_system : boolean (True)</span>
<span class="sd">            If True the function will call the createSystemObject() method</span>
<span class="sd">            to create an OpenMM system object.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        sbm : sbmOpenMM.system</span>
<span class="sd">            Initialized sbmOpenMM.system class with added multi basin contact potential.</span>
<span class="sd">        &quot;&quot;&quot;</span>
           
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">main_model</span><span class="p">,</span> <span class="n">system</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Multi basin contact potential only supports 2 configurations.&#39;</span><span class="o">+</span>
                            <span class="s1">&#39;The first, main_model, must be a sbmOpenMM system class </span><span class="se">\</span>
<span class="s1">                             containing the protein system.&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alternate_configuration</span><span class="p">,</span> <span class="n">system</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Multi basin contact potential only supports 2 configurations.&#39;</span><span class="o">+</span>
                            <span class="s1">&#39;The second, alternate_configuration, must be a sbmOpenMM system class </span><span class="se">\</span>
<span class="s1">                             containing the same protein system in a different conformation.&#39;</span><span class="p">)</span>
        
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">main_model</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">alternate_configuration</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating Multi Basin Potential&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Contact analysis:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;________________&#39;</span><span class="p">)</span>
        
        <span class="c1">#Create new sbm system object from main model object</span>
        <span class="n">multi_basin_model</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">main_model</span><span class="p">)</span>
        
        <span class="c1">#Set contact forcefield parameters to OrderedDict and None</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">contacts</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">n_contacts</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1">#Reset forces and force groups</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">harmonicBondForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">harmonicAngleForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">periodicTorsionForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">harmonicImproperForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">harmonicPlanarForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">lj12_6contactForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">lj12_10contactForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">lj12_10_6contactForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">singleGaussianContactForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">doubleGaussianContactForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">ljRepulsionForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">exclusions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">forceGroups</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        
        <span class="c1">#Initialise new system object</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">System</span><span class="p">()</span>
        
        <span class="c1">#Save contact sets with atom indexes only.</span>
        <span class="n">contacts</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">contact_atoms</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">main_model</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">alternate_configuration</span><span class="p">]):</span>
            <span class="n">contact_atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="p">:</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">contacts</span><span class="p">}</span>
            <span class="n">contacts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">m</span><span class="o">.</span><span class="n">contacts</span> <span class="p">])</span>
            
        <span class="c1">#Get sets of common and unique contacts.</span>
        <span class="n">common_contacts</span> <span class="o">=</span> <span class="n">contacts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">contacts</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">unique_contacts</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">unique_contacts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">contacts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">common_contacts</span>
        <span class="n">unique_contacts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">contacts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">common_contacts</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Contacts in main configuration: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contacts</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Contacts in alternate configuration: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contacts</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Common contacts between configurations: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">common_contacts</span><span class="p">)))</span>  
        
        <span class="c1">#Check common contacts with large differences (larger than double_minima_threshold)</span>
        <span class="c1">#in equilibrium position.</span>
        <span class="n">n_dm_contacts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">common_contacts</span><span class="p">:</span>
            
            <span class="c1">#Get main an alterante contact distances</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="n">contact_atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">]</span>
            <span class="n">d0</span> <span class="o">=</span> <span class="n">main_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact_atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">d1</span> <span class="o">=</span> <span class="n">alternate_configuration</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact_atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">c</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="c1">#Set minimum an maximum distance</span>
            <span class="n">r0</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span><span class="n">d1</span><span class="p">)</span>
            <span class="n">r1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span><span class="n">d1</span><span class="p">)</span>
            
            <span class="c1">#If difference between equilibrium distances is larger than threshold add double minimum parameters.</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">r0</span> <span class="o">-</span> <span class="n">r1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">double_minima_threshold</span><span class="p">:</span>
                
                <span class="c1">#If excluded_volume_radius not given treat lower wall as the minimum potential distance.</span>
                <span class="k">if</span> <span class="n">excluded_volume_radius</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">main_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    
                <span class="c1">#If excluded_volume_radius given add separate control of excluded volume.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">excluded_volume_radius</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">nanometer</span><span class="p">,</span> <span class="n">r0</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">main_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1">#Count added double minima</span>
                <span class="n">n_dm_contacts</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="c1">#Otherwise just add single basin parameter </span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#If excluded_volume_radius not given treat lower wall as the minimum potential distance.</span>
                <span class="k">if</span> <span class="n">excluded_volume_radius</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1">#Add regular Lennard-Jones parameters : use_lennard_jones=True</span>
                    <span class="k">if</span> <span class="n">use_lennard_jones</span><span class="p">:</span>
                        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">main_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="c1">#Add single minimum Gaussian : use_lennard_jones=False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">d0</span><span class="p">,</span> <span class="n">main_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1">#If excluded_volume_radius given add separate control of excluded volume.</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">excluded_volume_radius</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">nanometer</span><span class="p">,</span> <span class="n">d0</span><span class="p">,</span> <span class="n">main_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Common contacts with an equilibrium distance difference larger than </span><span class="si">%.2f</span><span class="s1"> nm: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> 
             <span class="p">(</span><span class="n">double_minima_threshold</span><span class="p">,</span> <span class="n">n_dm_contacts</span><span class="p">))</span>
        
        <span class="c1">#Add unique contacts in main configuration</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unique contacts in main configuration: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_contacts</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">unique_contacts</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="n">contact_atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">]</span>
            <span class="n">d0</span> <span class="o">=</span> <span class="n">main_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact_atoms</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">c</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1">#Add regular Lennard-Jones parameters : use_lennard_jones=True</span>
            <span class="k">if</span> <span class="n">use_lennard_jones</span><span class="p">:</span>
                <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">main_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1">#Add single minimum Gaussian : use_lennard_jones=False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">d0</span><span class="p">,</span> <span class="n">main_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                
        <span class="c1">#Add unique contacts in alternate configuration</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unique contacts in alternate configuration: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unique_contacts</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">unique_contacts</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="n">contact_atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">c</span><span class="p">]</span>
            <span class="n">d1</span> <span class="o">=</span> <span class="n">alternate_configuration</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact_atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">c</span><span class="p">]][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">atoms</span> <span class="o">=</span> <span class="n">contact_atoms</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">c</span><span class="p">]</span>
            <span class="c1">#Add regular Lennard-Jones parameters : use_lennard_jones=True</span>
            <span class="k">if</span> <span class="n">use_lennard_jones</span><span class="p">:</span>
                <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">alternate_configuration</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1">#Add single minimum Gaussian : use_lennard_jones=False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">alternate_configuration</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">atoms</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">n_contacts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">multi_basin_model</span><span class="o">.</span><span class="n">contacts</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total contacts in multi basin potential: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">multi_basin_model</span><span class="o">.</span><span class="n">n_contacts</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        <span class="c1">#Add forces to multi_basin_model</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Forces:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;_____________&#39;</span><span class="p">)</span>
        
        <span class="c1">#Add prexisting forces</span>
        <span class="k">if</span> <span class="n">main_model</span><span class="o">.</span><span class="n">harmonicBondForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Harmonic Bond Forces&#39;</span><span class="p">)</span>
            <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">addHarmonicBondForces</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">main_model</span><span class="o">.</span><span class="n">harmonicAngleForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Harmonic Angle Forces&#39;</span><span class="p">)</span>
            <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">addHarmonicAngleForces</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">main_model</span><span class="o">.</span><span class="n">periodicTorsionForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Periodic Torsion Forces&#39;</span><span class="p">)</span>
            <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">addPeriodicTorsionForces</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">main_model</span><span class="o">.</span><span class="n">harmonicImproperForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Harmonic Improper Forces&#39;</span><span class="p">)</span>
            <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">addHarmonicImproperForces</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">main_model</span><span class="o">.</span><span class="n">harmonicPlanarForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Periodic Planar Forces&#39;</span><span class="p">)</span>
            <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">addHarmonicPlanarForces</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">main_model</span><span class="o">.</span><span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;AA&#39;</span><span class="p">:</span>
            <span class="n">contact_parameters</span> <span class="o">=</span> <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">getAANativeContactParameters</span><span class="p">()</span>
            <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">setNativeContactParameters</span><span class="p">(</span><span class="n">contact_parameters</span><span class="p">)</span>
        
        <span class="c1">#Add contact forces</span>
        <span class="k">if</span> <span class="n">use_lennard_jones</span><span class="p">:</span>
            <span class="c1">#Add Lennard Jones contacts for AA model if main_model is AA.</span>
            <span class="k">if</span> <span class="n">main_model</span><span class="o">.</span><span class="n">lj12_6contactForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Lennard Jones 12-6 potential to single minimum contacts&#39;</span><span class="p">)</span>
                <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">addLJ12_6ContactForces</span><span class="p">()</span>

            <span class="c1">#Add Lennard Jones contacts for CA model if main_model is CA.</span>
            <span class="k">if</span> <span class="n">main_model</span><span class="o">.</span><span class="n">lj12_10contactForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Lennard Jones 12-10 potential to single minimum contacts&#39;</span><span class="p">)</span>
                <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">addLJ12_10ContactForces</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Gaussian potential to single minimum contacts&#39;</span><span class="p">)</span>
            
        <span class="c1">#Add gaussian potential</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding Gaussian potential to double minimum contacts&#39;</span><span class="p">)</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">addGaussianContactForces</span><span class="p">()</span>
        
        <span class="c1">#Add repulsion forces</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding repulsion Lennard Jones 12 potential for non native contacts&#39;</span><span class="p">)</span>
        <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">addLJRepulsionForces</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="n">multi_basin_model</span><span class="o">.</span><span class="n">rf_sigma</span><span class="p">,</span>
                                               <span class="n">epsilon</span><span class="o">=</span><span class="n">multi_basin_model</span><span class="o">.</span><span class="n">rf_epsilon</span><span class="p">,</span>
                                               <span class="n">cutoff</span><span class="o">=</span><span class="n">multi_basin_model</span><span class="o">.</span><span class="n">rf_cutoff</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Creating System Object:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;______________________&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">multi_basin_model</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">atoms</span><span class="p">())):</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">a</span><span class="p">,</span> <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>        
        
        <span class="k">if</span> <span class="n">create_system</span><span class="p">:</span>
            <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">createSystemObject</span><span class="p">(</span><span class="n">minimise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">check_bond_distances</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">main_model</span><span class="o">.</span><span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;AA&#39;</span><span class="p">:</span>
            <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;AA-MB&#39;</span>
        <span class="k">elif</span> <span class="n">main_model</span><span class="o">.</span><span class="n">model_type</span> <span class="o">==</span> <span class="s1">&#39;CA&#39;</span><span class="p">:</span>
            <span class="n">multi_basin_model</span><span class="o">.</span><span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;CA-MB&#39;</span>
        
        <span class="k">return</span> <span class="n">multi_basin_model</span></div></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, "Martin Floor, Kengjie Li".
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>