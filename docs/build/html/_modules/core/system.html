
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>core.system &#8212; sbmOpenMM 0.0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for core.system</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># coding: utf-8</span>

<span class="c1"># In[ ]:</span>


<span class="kn">from</span> <span class="nn">simtk.openmm.app</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">simtk.openmm</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">simtk</span> <span class="k">import</span> <span class="n">unit</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">.geometry</span> <span class="k">import</span> <span class="n">geometry</span>


<span class="c1"># In[ ]:</span>


<div class="viewcode-block" id="system"><a class="viewcode-back" href="../../index.html#core.models.system">[docs]</a><span class="k">class</span> <span class="nc">system</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class containing methods and parameters for generating Structure Based</span>
<span class="sd">    Models (SBM) systems to be simulated using the OpenMM interface. It offers </span>
<span class="sd">    flexibility to create default and custom SBM systems and to easily </span>
<span class="sd">    modify their parameters.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    pdb_path : string</span>
<span class="sd">        Path to the pdb input file</span>
<span class="sd">    pdb : openmm.app.pdbfile.PDBFile</span>
<span class="sd">        Object that holds the information of OpenMM PDB parsing method.</span>
<span class="sd">    topology : openmm.app.topology.Topology</span>
<span class="sd">        OpenMM topology of the model.</span>
<span class="sd">    positions : unit.quantity.Quantity</span>
<span class="sd">        Atomic positions of the model.</span>
<span class="sd">    particles_mass : float or list</span>
<span class="sd">        Mass of each particle. If float then uniform masses are given to all </span>
<span class="sd">        particles. If list per-particle masses are assigned.</span>
<span class="sd">    model_type : string</span>
<span class="sd">        String representing the model type: All-atom (AA), alpha-carbon (CA)</span>
<span class="sd">        or multi-basin variants (AA-MB, CA-MB).</span>
<span class="sd">    atoms : list</span>
<span class="sd">        A list of the current atoms in the model. The items are simtk.openmm.app.topology.Atom</span>
<span class="sd">        initialised classes.</span>
<span class="sd">    n_atoms : int</span>
<span class="sd">        Total numer of atoms in the model.</span>
<span class="sd">    bonds : collections.OrderedDict</span>
<span class="sd">        A dict that uses bonds (2-tuple of simtk.openmm.app.topology.Atom objects) </span>
<span class="sd">        present in the model as keys and their forcefield properties as values.</span>
<span class="sd">    bonds_indexes : list</span>
<span class="sd">        A list containing the zero-based indexes of the atoms defining the bonds in the model.</span>
<span class="sd">    n_bonds : int</span>
<span class="sd">        Total numer of bonds in the model.</span>
<span class="sd">    angles : collections.OrderedDict</span>
<span class="sd">        A dict that uses angles (3-tuple of simtk.openmm.app.topology.Atom objects)</span>
<span class="sd">        present in the model as keys and their forcefield properties as values.</span>
<span class="sd">    angles_indexes : list</span>
<span class="sd">        A list containing the zero-based indexes of the atoms defining the angles in the model.</span>
<span class="sd">    n_angles : int</span>
<span class="sd">        Total numer of angles in the model.</span>
<span class="sd">    torsions : collections.OrderedDict</span>
<span class="sd">        A dict that uses proper torsions (4-tuple of simtk.openmm.app.topology.Atom objects) </span>
<span class="sd">        present in the model as keys and their forcefield properties as values.</span>
<span class="sd">    torions_indexes : list</span>
<span class="sd">        A list containing the zero-based indexes of the atoms defining the torsions in the model.</span>
<span class="sd">    n_torsions : int</span>
<span class="sd">        Total numer of proper torsions in the model.</span>
<span class="sd">    impropers : collections.OrderedDict</span>
<span class="sd">        A dict that uses improper torsions (4-tuple of simtk.openmm.app.topology.Atom objects)</span>
<span class="sd">        present in the model as keys and their forcefield properties as values.</span>
<span class="sd">    impropers_indexes : list</span>
<span class="sd">        A list containing the zero-based indexes of the atoms defining the imporpers in the model.</span>
<span class="sd">    n_impropers : int</span>
<span class="sd">        Total numer of improper torsions in the model.</span>
<span class="sd">    planars : collections.OrderedDict</span>
<span class="sd">        A dict that uses planar torsions (4-tuple of simtk.openmm.app.topology.Atom objects)</span>
<span class="sd">        present in the model as keys and their forcefield properties as values.</span>
<span class="sd">    planars_indexes : list</span>
<span class="sd">        A list containing the zero-based indexes of the atoms defining the planars in the model.</span>
<span class="sd">    n_planars : int</span>
<span class="sd">        Total numer of planar torsions in the model.</span>
<span class="sd">    contacts : collections.OrderedDict</span>
<span class="sd">        A dict that uses native contacts (2-tuple of simtk.openmm.app.topology.Atom objects</span>
<span class="sd">        present in the model as keys and their forcefield properties as values.</span>
<span class="sd">    contacts_indexes : list</span>
<span class="sd">        A list containing the zero-based indexes of the atoms defining the contacts in the model.</span>
<span class="sd">    n_contacts : int</span>
<span class="sd">        Total numer of native contacts in the model.</span>
<span class="sd">    torsions_group : dict</span>
<span class="sd">        A dict that uses proper torsions two central atoms (2-tuple of simtk.openmm.app.topology.Atom objects)</span>
<span class="sd">        present in the model&#39;s topology as keys and the number of torsions (int) that share these same middle </span>
<span class="sd">        bond atoms as values.</span>
<span class="sd">    torsions_type : dict</span>
<span class="sd">        A dict that uses proper torsions (4-tuple of simtk.openmm.app.topology.Atom objects)</span>
<span class="sd">        present in the model as keys and, a string representing wheter the torsion </span>
<span class="sd">        is classified as &#39;backbone&#39; or &#39;sidechain&#39; as values.</span>
<span class="sd">    energy_constant : dict</span>
<span class="sd">        A dict that holds the value for the different energy terms parameters</span>
<span class="sd">        used by different SBM models and forces.</span>
<span class="sd">    harmonicBondForce : openmm.HarmonicBondForce</span>
<span class="sd">        Stores the OpenMM HarmonicBondForce initialised-class. Implements</span>
<span class="sd">        an harmonic bond potential between pairs of particles, that depends</span>
<span class="sd">        quadratically on their distance.</span>
<span class="sd">    harmonicAngleForce : openmm.HarmonicAngleForce</span>
<span class="sd">        Stores the OpenMM HarmonicAngleForce initialised-class. Implements</span>
<span class="sd">        an harmonic angle potential between trios of particles, that depends</span>
<span class="sd">        quadratically on their angle length.</span>
<span class="sd">    periodicTorsionForce : openmm.CustomTorsionForce</span>
<span class="sd">        Stores the OpenMM CustomTorsionForce initialised-class. Implements </span>
<span class="sd">        a force potential that varies periodically with the value of the </span>
<span class="sd">        proper torsion angle.</span>
<span class="sd">    generalPeriodicTorsionForce : openmm.CustomTorsionForce</span>
<span class="sd">        Stores the OpenMM CustomTorsionForce initialised-class. Implements </span>
<span class="sd">        a general force potential that varies periodically with the value of the </span>
<span class="sd">        proper torsion angle.</span>
<span class="sd">    harmonicImproperForce : openmm.CustomTorsionForce</span>
<span class="sd">        Stores the OpenMM CustomTorsionForce initialised-class. Implements </span>
<span class="sd">        a force potential that varies quadratically with the value of the  </span>
<span class="sd">        improper torsion angle.</span>
<span class="sd">    harmonicPlanarForce : openmm.CustomTorsionForce</span>
<span class="sd">        Stores the OpenMM CustomTorsionForce initialised-class. Implements </span>
<span class="sd">        a force potential that varies quadratically with the value of the  </span>
<span class="sd">        planar torsion angle.</span>
<span class="sd">    lj12_6contactForce : openmm.CustomBondForce</span>
<span class="sd">        Stores the OpenMM CustomBondForce initialised-class to be applied</span>
<span class="sd">        to non-bonded interactions between native contact pairs. Implements </span>
<span class="sd">        a lennard-jones potential with exponents 12 and 6 for the repulsive</span>
<span class="sd">        and attractive componenets, respectively.</span>
<span class="sd">    lj12_10contactForce : openmm.CustomBondForce</span>
<span class="sd">        Stores the OpenMM CustomBondForce initialised-class to be applied</span>
<span class="sd">        to non-bonded interactions between native contact pairs. Implements </span>
<span class="sd">        a lennard-jones potential with exponents 12 and 10 for the repulsive</span>
<span class="sd">        and attractive components, respectively.</span>
<span class="sd">    lj12_10_6contactForce : openmm.CustomBondForce</span>
<span class="sd">        Stores the OpenMM CustomBondForce initialised-class to be applied</span>
<span class="sd">        to non-bonded interactions between native contact pairs. Implements </span>
<span class="sd">        a lennard-jones potential with exponents 12 and 10 for the repulsive</span>
<span class="sd">        and attractive components, respectively, and an additional 6-exponent </span>
<span class="sd">        term to model a “desolvation penalty” for forming/breaking contacts.</span>
<span class="sd">    singleGaussianContactForce : openmm.CustomNonbondedForce</span>
<span class="sd">        Stores the OpenMM CustomBondForce initialised-class to be applied</span>
<span class="sd">        to non-bonded interactions between native contact pairs with single</span>
<span class="sd">        minimum. Implements a mixed lennard-jones (repulsive) and gaussian</span>
<span class="sd">        potential (attractive) with separate control of equilibrium distance</span>
<span class="sd">        and excluded volume.</span>
<span class="sd">    doubleGaussianContactForce : openmm.CustomNonbondedForce</span>
<span class="sd">        Stores the OpenMM CustomBondForce initialised-class to be applied</span>
<span class="sd">        to non-bonded interactions between native contact pairs with two </span>
<span class="sd">        minima. Implements a mixed lennard-jones (repulsive) and gaussian</span>
<span class="sd">        potential (attractive) with separate control of the equilibrium </span>
<span class="sd">        distances and excluded volume.</span>
<span class="sd">    ljRepulsionForce : openmm.CustomNonbondedForce</span>
<span class="sd">        Stores the OpenMM CustomBondForce initialised-class to be applied</span>
<span class="sd">        to the non-bonded interactions between non-native contact pairs. </span>
<span class="sd">        Implements only a repulsive lennard-jones potential with exponent </span>
<span class="sd">        12.</span>
<span class="sd">    forceGroups : collections.OrderedDict</span>
<span class="sd">        A dict that uses force names as keys and their corresponding force</span>
<span class="sd">        as values.</span>
<span class="sd">    system : openmm.System</span>
<span class="sd">        Stores the OpenMM System initialised class. It stores all the forcefield</span>
<span class="sd">        information for the SBM model.</span>
<span class="sd">    rf_epsilon : float</span>
<span class="sd">        Epsilon parameter used in the repulsion force object.</span>
<span class="sd">    rf_sigma : float</span>
<span class="sd">        Sigma parameter used in the repulsion force object.</span>
<span class="sd">    rf_cutoff : float</span>
<span class="sd">        Cutoff value used for repulsion force interactions.</span>
<span class="sd">    exclusions : list</span>
<span class="sd">        List of added exclusions for the repuslion non-bonded term.</span>
<span class="sd">    </span>
<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    removeHydrogens()</span>
<span class="sd">        Remove hydrogens from the input pdb by using a regexpression pattern.</span>
<span class="sd">        Used specially for creating all atom (AA) models.</span>
<span class="sd">    getCAlphaOnly()</span>
<span class="sd">        Filter in only alpha carbon atoms from the input pdb and updates </span>
<span class="sd">        the topology object to add new bonds between them. Used specially for </span>
<span class="sd">        creating alpha-carbon (CA) corse-grained models.</span>
<span class="sd">    getAtoms()</span>
<span class="sd">        Reads atoms from topology, adds them to the main class and sorts them </span>
<span class="sd">        into a dictionary to store their forcefield properties.</span>
<span class="sd">    getBonds()</span>
<span class="sd">        Reads bonds from topology, adds them to the main class and sorts them </span>
<span class="sd">        into a dictionary to store their forcefield properties.</span>
<span class="sd">    getAngles()</span>
<span class="sd">        Reads bonds from topology and creates a list of all possible angles,</span>
<span class="sd">        adds them to the main class and sorts them into a dictionary to store </span>
<span class="sd">        their forcefield properties.</span>
<span class="sd">    getProperTorsions()</span>
<span class="sd">        Using the created angles, usually by the getAngles() method, creates </span>
<span class="sd">        a list of all possible proper torsion dihedral angles, filtering out </span>
<span class="sd">        torsions based on residue-specific rules (only for the all-atom model).</span>
<span class="sd">        The torsions are then added to the main class and sorted into a dictionary </span>
<span class="sd">        to store their forcefield properties.</span>
<span class="sd">    getImpropers()</span>
<span class="sd">        Create improper torsions based on backbone and sidechain residue-specific </span>
<span class="sd">        rules (all-atom model only), adds them to the main class and sorts them </span>
<span class="sd">        into a dictionary to store their forcefield properties.</span>
<span class="sd">    getPlanars()</span>
<span class="sd">        Create planar torsions based on backbone and sidechain residue-specific </span>
<span class="sd">        rules (all-atom model only), adds them to the main class and sorts them </span>
<span class="sd">        into a dictionary to store their forcefield properties.</span>
<span class="sd">    readContactFile()</span>
<span class="sd">        Reads a file containing native contact information and adds it into the </span>
<span class="sd">        main class. The file can be smog-style (4 columns) or given as 2 columns.</span>
<span class="sd">        The format will be automatically detected. </span>
<span class="sd">    setBondParameters()</span>
<span class="sd">        Change the forcefield parameters for bonded terms.</span>
<span class="sd">    setAngleParameters()</span>
<span class="sd">        Change the forcefield parameters for angle terms.</span>
<span class="sd">    setProperTorsionParameters()</span>
<span class="sd">        Change the forcefield parameters for proper torsion terms.</span>
<span class="sd">    setImproperParameters()</span>
<span class="sd">        Change the forcefield parameters for improper torsion </span>
<span class="sd">        terms.</span>
<span class="sd">    setPlanarParameters()</span>
<span class="sd">        Change the forcefield parameters for planar torsion terms.</span>
<span class="sd">    setNativeContactParameters()</span>
<span class="sd">        Change the forcefield parameters for native contact terms.</span>
<span class="sd">    setParticlesMasses()</span>
<span class="sd">        Change the mass parameter for each atom in the system.</span>
<span class="sd">    addHarmonicBondForces()</span>
<span class="sd">        Creates an harmonic bonded force term for each bond in the main</span>
<span class="sd">        class using their defined forcefield parameters.</span>
<span class="sd">    addHarmonicAngleForces()</span>
<span class="sd">        Creates an harmonic angle force term for each angle in the main</span>
<span class="sd">        class using their defined forcefield parameters.</span>
<span class="sd">    addPeriodicTorsionForces()</span>
<span class="sd">        Creates a periodic torsion force term for each proper torsion in </span>
<span class="sd">        the main class using their defined forcefield parameters.</span>
<span class="sd">    addGenericPeriodicTorsionForces()</span>
<span class="sd">        Creates a periodic torsion force term for each proper torsion in </span>
<span class="sd">        the main class using their defined forcefield parameters.</span>
<span class="sd">    addHarmonicImproperForces()</span>
<span class="sd">        Creates an harmonic torsion force term for each improper torsion </span>
<span class="sd">        in the main class using their defined forcefield parameters. Used </span>
<span class="sd">        specially for simulating All Atom systems.</span>
<span class="sd">    addHarmonicPlanarForces()</span>
<span class="sd">        Creates an harmonic torsion force term for each planar torsion in</span>
<span class="sd">        the main class using their defined forcefield parameters. Used specially</span>
<span class="sd">        for simulating All Atom systems.</span>
<span class="sd">    addLJ12_6ContactForces()</span>
<span class="sd">        Creates a 12-6 Lennard-Jones bond potential for each native contact</span>
<span class="sd">        in the main class using their defined forcefield parameters. Used </span>
<span class="sd">        specially for simulating All Atom systems.</span>
<span class="sd">    addLJ12_10ContactForces()</span>
<span class="sd">        Creates a 12-10 Lennard-Jones bond potential for each native contact</span>
<span class="sd">        in the main class using their defined forcefield parameters. Used </span>
<span class="sd">        specially for simulating coarse-grained alpha-carbon systems.</span>
<span class="sd">    addGaussianContactForces()</span>
<span class="sd">        Creates a gaussian single and double basin bond potential for each </span>
<span class="sd">        native contact in the main class using their defined forcefield </span>
<span class="sd">        parameters. The contacts are recognized according two the number </span>
<span class="sd">        of parameters given as values in the attribute system. 3-parameters for</span>
<span class="sd">        single-basin potential and 4-paramters for dual-basin potentials.</span>
<span class="sd">    addLJRepulsionForces()</span>
<span class="sd">        Creates a repulsive-only 12 Lennard-Jones non-bonded potential specifying </span>
<span class="sd">        a exclusion list for bond, angle, torsion, and native contact terms. </span>
<span class="sd">    groupTorsionsbyBBAndSC()</span>
<span class="sd">        Groups proper torsions by backbone and sidechain torsions. Used exclusively</span>
<span class="sd">        for simulating all-atom SBM.</span>
<span class="sd">    getAATorsionParameters()</span>
<span class="sd">        Generates default periodic torsion forcefield parameters, for proper</span>
<span class="sd">        torsions, using pre-defined assignment schemes. Used exclusively for </span>
<span class="sd">        simulating all-atom SBM.</span>
<span class="sd">    getAANativeContactParameters()</span>
<span class="sd">        Generates default bonded contact forcefield parameters, for native </span>
<span class="sd">        contacts, using pre-defined assignment schemes. Used exclusively for </span>
<span class="sd">        simulating all-atom SBM.</span>
<span class="sd">    createSystemObject()</span>
<span class="sd">        Creates OpenMM system object adding particles, masses and forces. </span>
<span class="sd">        It also groups the added forces into Force-Groups for the sbmReporter</span>
<span class="sd">        class.</span>
<span class="sd">    addParticles()</span>
<span class="sd">        Add particles to the system OpenMM class instance.</span>
<span class="sd">    addSystemForces()</span>
<span class="sd">        Add forces to the system OpenMM class instance. It also save</span>
<span class="sd">        names for the added forces to include them in the reporter class.</span>
<span class="sd">    dumpPdb()</span>
<span class="sd">        Writes a PDB file of the system in its current state.</span>
<span class="sd">    dumpForceFieldData()</span>
<span class="sd">        Writes to a file the parameters of the SBM forcefield.</span>
<span class="sd">    loadForcefieldFromFile()</span>
<span class="sd">        Loads forcefield parameters from a sbmOpenMM force field file written with</span>
<span class="sd">        the dumpForceFieldData() method.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdb_path</span><span class="p">,</span> <span class="n">particles_mass</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialises the SBM OpenMM system class.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pdb_path : string</span>
<span class="sd">            Name of the input PDB file</span>
<span class="sd">        particles_mass : float or list</span>
<span class="sd">            mass of all the particles in the system.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Define structure object attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb_path</span> <span class="o">=</span> <span class="n">pdb_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span> <span class="o">=</span> <span class="n">PDBFile</span><span class="p">(</span><span class="n">pdb_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topology</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">topology</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particles_mass</span> <span class="o">=</span> <span class="n">particles_mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1">#Define geometric attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_atoms</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bonds_indexes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_bonds</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">angles_indexes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_angles</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">torsions</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">torsions_indexes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_torsions</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impropers</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impropers_indexes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_impropers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">planars</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">planars_indexes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_planars</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contacts_indexes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_contacts</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1">#Define force field attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">torsions_group</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">torsions_type</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energy_constant</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1">#Define force attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">harmonicBondForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">harmonicAngleForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodicTorsionForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generalPeriodicTorsionForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">harmonicImproperForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">harmonicPlanarForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lj12_6contactForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lj12_10contactForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lj12_10_6contactForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">singleGaussianContactForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">doubleGaussianContactForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ljRepulsionForce</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rf_sigma</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rf_epsilon</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rf_cutoff</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclusions</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        
        <span class="c1">#Initialise an OpenMM system class instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">System</span><span class="p">()</span>
        
<div class="viewcode-block" id="system.removeHydrogens"><a class="viewcode-back" href="../../index.html#core.models.system.removeHydrogens">[docs]</a>    <span class="k">def</span> <span class="nf">removeHydrogens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes all hydrogen atoms in the topology from the SBM system.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#save all hydrogen atoms</span>
        <span class="n">atomsToRemove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_hydrogen</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;[123 ]*H.*&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">atoms</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">_hydrogen</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="n">atomsToRemove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        
        <span class="c1">#Remove all hydrogen atoms</span>
        <span class="n">modeller_topology</span> <span class="o">=</span> <span class="n">modeller</span><span class="o">.</span><span class="n">Modeller</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
        <span class="n">modeller_topology</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">atomsToRemove</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topology</span> <span class="o">=</span> <span class="n">modeller_topology</span><span class="o">.</span><span class="n">getTopology</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">modeller_topology</span><span class="o">.</span><span class="n">getPositions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;AA&#39;</span></div>
        
<div class="viewcode-block" id="system.getCAlphaOnly"><a class="viewcode-back" href="../../index.html#core.models.system.getCAlphaOnly">[docs]</a>    <span class="k">def</span> <span class="nf">getCAlphaOnly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Keeps in the SBM system only the alpha carbon atoms from the OpenMM topology.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#save all non C-alpha atoms</span>
        <span class="n">atomsToRemove</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">oldIndex</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">atoms</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;CA&#39;</span><span class="p">:</span>
                <span class="n">atomsToRemove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        
        <span class="c1">#Remove all non C-alpha atoms</span>
        <span class="n">modeller_topology</span> <span class="o">=</span> <span class="n">modeller</span><span class="o">.</span><span class="n">Modeller</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
        <span class="n">modeller_topology</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">atomsToRemove</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topology</span> <span class="o">=</span> <span class="n">modeller_topology</span><span class="o">.</span><span class="n">getTopology</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">modeller_topology</span><span class="o">.</span><span class="n">getPositions</span><span class="p">()</span>
        
        <span class="c1">#Update system atoms</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">atoms</span><span class="p">())</span>
        
        <span class="c1">#Add bonds between C-alpha atoms of the same chain</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)):</span>
            <span class="n">current_chain</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">chain</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">previous_chain</span> <span class="o">=</span> <span class="n">current_chain</span>
                
            <span class="c1">#Add bond only when atoms belong to the same chain</span>
            <span class="k">if</span> <span class="n">current_chain</span> <span class="o">==</span> <span class="n">previous_chain</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">addBond</span><span class="p">(</span><span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">atoms</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">previous_chain</span> <span class="o">=</span> <span class="n">current_chain</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">model_type</span> <span class="o">=</span> <span class="s1">&#39;CA&#39;</span></div>
            
<div class="viewcode-block" id="system.getAtoms"><a class="viewcode-back" href="../../index.html#core.models.system.getAtoms">[docs]</a>    <span class="k">def</span> <span class="nf">getAtoms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds atoms in the OpenMM topology instance to the sbmOpenMM system class.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Get Atoms From Topology</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">atoms</span><span class="p">():</span>
            <span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
        
        <span class="c1">#Sort atoms by index</span>
        <span class="n">atoms</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        
        <span class="c1">#Add atoms to sbm object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_atoms</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">atoms</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">atom</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_atoms</span> <span class="o">+=</span> <span class="mi">1</span></div>
            
<div class="viewcode-block" id="system.getBonds"><a class="viewcode-back" href="../../index.html#core.models.system.getBonds">[docs]</a>    <span class="k">def</span> <span class="nf">getBonds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds bonds in the OpenMM topology instance to the sbmOpenMM system class.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Get Bonds From Topology</span>
        <span class="n">bonds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">bonds</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                <span class="n">bonds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bonds</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        
        <span class="c1">#Sort bonds by index of first atom</span>
        <span class="n">bonds</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">bonds</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        
        <span class="c1">#Add bonds to sbm object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_bonds</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="n">bonds</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">bond_length</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">bond</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="n">bond</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">bond_length</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_bonds</span> <span class="o">+=</span> <span class="mi">1</span>
        
            <span class="c1">#Store bond indexes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bonds_indexes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                                       <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
            
        <span class="c1">#Record which atoms are bonded to each other</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bondedTo</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">atoms</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bondedTo</span><span class="p">[</span><span class="n">atom</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">bonds</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bondedTo</span><span class="p">[</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bondedTo</span><span class="p">[</span><span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>
            
<div class="viewcode-block" id="system.getAngles"><a class="viewcode-back" href="../../index.html#core.models.system.getAngles">[docs]</a>    <span class="k">def</span> <span class="nf">getAngles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds angles to the sbmOpenMM system class based on the bondings in the topology </span>
<span class="sd">        object.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Make a list of all unique angles</span>
        <span class="n">uniqueAngles</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bondedTo</span><span class="p">[</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
                <span class="k">if</span> <span class="n">atom</span> <span class="o">!=</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                        <span class="n">uniqueAngles</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">atom</span><span class="p">,</span> <span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">uniqueAngles</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">atom</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bondedTo</span><span class="p">[</span><span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
                <span class="k">if</span> <span class="n">atom</span> <span class="o">!=</span> <span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                        <span class="n">uniqueAngles</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">atom</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">uniqueAngles</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">atom</span><span class="p">,</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                        
        <span class="c1">#Sort angles by index of first atom</span>
        <span class="n">uniqueAngles</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">uniqueAngles</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        
        <span class="c1">#Add angles to sbm object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_angles</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">uniqueAngles</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">p3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">angle</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">angle_length</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">angle</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">angle_length</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_angles</span> <span class="o">+=</span> <span class="mi">1</span>
        
            <span class="c1">#Store angle indexes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">angles_indexes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                        <span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                        <span class="n">angle</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span></div>
        
<div class="viewcode-block" id="system.getProperTorsions"><a class="viewcode-back" href="../../index.html#core.models.system.getProperTorsions">[docs]</a>    <span class="k">def</span> <span class="nf">getProperTorsions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds proper torsions to the sbmOpenMM system class based on the bonded angles</span>
<span class="sd">        in it. Excludes special torsions for rings and backbones.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Make a list of all unique proper torsions</span>
        <span class="n">uniqueTorsions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bondedTo</span><span class="p">[</span><span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">]]:</span>
                <span class="k">if</span> <span class="n">atom</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">angle</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">angle</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                        <span class="n">uniqueTorsions</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">atom</span><span class="p">,</span> <span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">angle</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">uniqueTorsions</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">angle</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">atom</span><span class="p">))</span>
                        
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bondedTo</span><span class="p">[</span><span class="n">angle</span><span class="p">[</span><span class="mi">2</span><span class="p">]]:</span>
                <span class="k">if</span> <span class="n">atom</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">angle</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;</span> <span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
                        <span class="n">uniqueTorsions</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">angle</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">atom</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">uniqueTorsions</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">atom</span><span class="p">,</span> <span class="n">angle</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        
        <span class="c1">#Create dictionary with ring atoms for generating exclusions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ring_exclusions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ring_exclusions</span><span class="p">[</span><span class="s1">&#39;PRO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;CB&#39;</span><span class="p">,</span> <span class="s1">&#39;CD&#39;</span><span class="p">,</span> <span class="s1">&#39;CG&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ring_exclusions</span><span class="p">[</span><span class="s1">&#39;HIS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">,</span> <span class="s1">&#39;ND1&#39;</span><span class="p">,</span> <span class="s1">&#39;CD2&#39;</span><span class="p">,</span> <span class="s1">&#39;CE1&#39;</span><span class="p">,</span> <span class="s1">&#39;NE2&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ring_exclusions</span><span class="p">[</span><span class="s1">&#39;TYR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">,</span> <span class="s1">&#39;CD1&#39;</span><span class="p">,</span> <span class="s1">&#39;CD2&#39;</span><span class="p">,</span> <span class="s1">&#39;CE1&#39;</span><span class="p">,</span> <span class="s1">&#39;CE2&#39;</span><span class="p">,</span> <span class="s1">&#39;CZ&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ring_exclusions</span><span class="p">[</span><span class="s1">&#39;PHE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">,</span> <span class="s1">&#39;CD1&#39;</span><span class="p">,</span> <span class="s1">&#39;CD2&#39;</span><span class="p">,</span> <span class="s1">&#39;CE1&#39;</span><span class="p">,</span> <span class="s1">&#39;CE2&#39;</span><span class="p">,</span> <span class="s1">&#39;CZ&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ring_exclusions</span><span class="p">[</span><span class="s1">&#39;TRP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">,</span> <span class="s1">&#39;CD1&#39;</span><span class="p">,</span> <span class="s1">&#39;CD2&#39;</span><span class="p">,</span> <span class="s1">&#39;NE1&#39;</span><span class="p">,</span> <span class="s1">&#39;CE2&#39;</span><span class="p">,</span> <span class="s1">&#39;CE3&#39;</span><span class="p">,</span> <span class="s1">&#39;CZ2&#39;</span><span class="p">,</span> <span class="s1">&#39;CZ3&#39;</span><span class="p">,</span> <span class="s1">&#39;CH2&#39;</span><span class="p">]</span>
        
        <span class="c1">#Exclude torsions inside rings</span>
        <span class="n">toExclude</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">torsion</span> <span class="ow">in</span> <span class="n">uniqueTorsions</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">torsion</span><span class="p">])</span> <span class="o">-</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="ow">or</span>                <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">torsion</span><span class="p">])</span> <span class="o">-</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">torsion</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">count</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">count</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">count</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">count</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ring_exclusions</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                            <span class="n">in_ring</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">torsion</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ring_exclusions</span><span class="p">[</span><span class="n">r</span><span class="p">]:</span>
                                    <span class="n">in_ring</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="k">if</span> <span class="n">in_ring</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                                <span class="n">toExclude</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">torsion</span><span class="p">)</span>
                                
        <span class="c1">#Exclude specific backbone torsions</span>
        <span class="k">for</span> <span class="n">torsion</span> <span class="ow">in</span> <span class="n">uniqueTorsions</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">torsion</span><span class="p">])</span> <span class="o">-</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span> 
                <span class="k">if</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">torsion</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;CA&#39;</span><span class="p">]:</span>
                    <span class="n">toExclude</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">torsion</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">torsion</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;CA&#39;</span><span class="p">]:</span>
                    <span class="n">toExclude</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">torsion</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">torsion</span><span class="p">])</span> <span class="o">-</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span> 
                <span class="k">if</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;PRO&#39;</span><span class="p">,</span><span class="s1">&#39;PRO&#39;</span><span class="p">,</span><span class="s1">&#39;PRO&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]:</span>
                        <span class="n">toExclude</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">torsion</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">2</span><span class="p">:]]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;PRO&#39;</span><span class="p">,</span><span class="s1">&#39;PRO&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">2</span><span class="p">:]]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;CD&#39;</span><span class="p">]:</span>
                    <span class="n">toExclude</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">torsion</span><span class="p">)</span>
        
        <span class="c1">#Remove added torsions</span>
        <span class="k">for</span> <span class="n">torsion</span> <span class="ow">in</span> <span class="n">toExclude</span><span class="p">:</span>
            <span class="n">uniqueTorsions</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">torsion</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniqueTorsions</span> <span class="o">=</span> <span class="n">uniqueTorsions</span>
        
        <span class="c1">#Sort torsions by the first atom index</span>
        <span class="n">uniqueTorsions</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">uniqueTorsions</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        
        <span class="c1">#Add torsions to sbm object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_torsions</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">torsion</span> <span class="ow">in</span> <span class="n">uniqueTorsions</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">torsion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">p3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">torsion</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">p4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">torsion</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">torsion_angle</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">torsion</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">torsions</span><span class="p">[</span><span class="n">torsion</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">torsion_angle</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_torsions</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="c1">#Store torsion indexes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">torsions_indexes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">torsion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                          <span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                          <span class="n">torsion</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                          <span class="n">torsion</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span></div>
            
<div class="viewcode-block" id="system.getImpropers"><a class="viewcode-back" href="../../index.html#core.models.system.getImpropers">[docs]</a>    <span class="k">def</span> <span class="nf">getImpropers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds improper torsions to the sbmOpenMM system class to maintain backbone </span>
<span class="sd">        chiralities.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Iterate by every chain in topology to add backbone impropers</span>
        <span class="n">chains</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">chains</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
            <span class="c1">#Iterate by every residue in chain to add backbone impropers</span>
            <span class="n">residues</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">chain</span><span class="o">.</span><span class="n">residues</span><span class="p">()]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">residues</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ad1</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">:</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">()}</span>
                <span class="n">ad2</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">:</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">()}</span>

                <span class="k">if</span> <span class="n">residues</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;PRO&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">impropers</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">ad2</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">ad2</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">impropers</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">ad2</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">ad2</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1">#Add impropers to sbm object</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_impropers</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">improper</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">impropers</span><span class="p">:</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">improper</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">improper</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="n">p3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">improper</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="n">p4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">improper</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                <span class="n">improper_angle</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">torsion</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">impropers</span><span class="p">[</span><span class="n">improper</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">improper_angle</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_impropers</span> <span class="o">+=</span> <span class="mi">1</span>
                
                <span class="c1">#Store improper indexes</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">impropers_indexes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">improper</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                               <span class="n">improper</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                               <span class="n">improper</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                               <span class="n">improper</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span></div>
            
<div class="viewcode-block" id="system.getPlanars"><a class="viewcode-back" href="../../index.html#core.models.system.getPlanars">[docs]</a>    <span class="k">def</span> <span class="nf">getPlanars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds planar torsions to the sbmOpenMM system class to mantain side chain and </span>
<span class="sd">        backbone planar arrangements.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Iterate by every chain in topology to add specific planar restraints</span>
        <span class="n">chains</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">chains</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">chain</span> <span class="ow">in</span> <span class="n">chains</span><span class="p">:</span>
            <span class="c1">#Iterate by every residue in chain to add specific planar restraints</span>
            <span class="n">residues</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">chain</span><span class="o">.</span><span class="n">residues</span><span class="p">()]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">residues</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">residues</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">ad1</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">:</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">()}</span>
                    <span class="n">ad2</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">:</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">()}</span>
                    
                    <span class="n">rn1</span> <span class="o">=</span> <span class="n">residues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">rn2</span> <span class="o">=</span> <span class="n">residues</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">ad2</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="k">if</span> <span class="n">rn1</span> <span class="o">!=</span> <span class="s1">&#39;GLY&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ad1</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">:</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">atoms</span><span class="p">()}</span>
                    <span class="n">ad2</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="n">rn1</span> <span class="o">=</span> <span class="n">residues</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">rn2</span> <span class="o">=</span> <span class="kc">None</span>
                    
                    <span class="k">if</span> <span class="n">rn1</span> <span class="o">!=</span> <span class="s1">&#39;GLY&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                        
                    <span class="k">if</span> <span class="s1">&#39;OXT&#39;</span> <span class="ow">in</span> <span class="n">ad1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;OXT&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">rn1</span> <span class="o">==</span> <span class="s1">&#39;ARG&#39;</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;NH1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;NH2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;NE&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;NH1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;NH2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">elif</span> <span class="n">rn1</span> <span class="o">==</span> <span class="s1">&#39;ASN&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;ND2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;OD1&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">elif</span> <span class="n">rn1</span> <span class="o">==</span> <span class="s1">&#39;ASP&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;OD1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;OD2&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">elif</span> <span class="n">rn1</span> <span class="o">==</span> <span class="s1">&#39;GLN&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;NE2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;OE1&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">elif</span> <span class="n">rn1</span> <span class="o">==</span> <span class="s1">&#39;GLU&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;OE1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;OE2&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">elif</span> <span class="n">rn1</span> <span class="o">==</span> <span class="s1">&#39;HIS&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;ND1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;NE2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;ND1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;ND1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;NE2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;ND1&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;NE2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;ND1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE1&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;NE2&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">elif</span> <span class="n">rn1</span> <span class="o">==</span> <span class="s1">&#39;PHE&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE2&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD1&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE1&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">elif</span> <span class="n">rn1</span> <span class="o">==</span> <span class="s1">&#39;PRO&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">elif</span> <span class="n">rn1</span> <span class="o">==</span> <span class="s1">&#39;TRP&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE2&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;NE1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CH2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE3&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ3&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;NE1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE3&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CH2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD1&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ3&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;NE1&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CH2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE3&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE2&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ3&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;NE1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ2&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE3&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CH2&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ3&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">elif</span> <span class="n">rn1</span> <span class="o">==</span> <span class="s1">&#39;TYR&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE2&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD1&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE1&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CE2&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CZ&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;OH&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">elif</span> <span class="n">rn1</span> <span class="o">==</span> <span class="s1">&#39;LEU&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CD2&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">elif</span> <span class="n">rn1</span> <span class="o">==</span> <span class="s1">&#39;THR&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;OG1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG2&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">elif</span> <span class="n">rn1</span> <span class="o">==</span> <span class="s1">&#39;VAL&#39;</span> <span class="ow">or</span> <span class="n">rn1</span> <span class="o">==</span> <span class="s1">&#39;ILE&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG1&#39;</span><span class="p">],</span> <span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;CG2&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">rn2</span> <span class="o">==</span> <span class="s1">&#39;PRO&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">ad2</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">ad2</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">],</span> <span class="n">ad2</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">ad1</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="n">ad2</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">ad2</span><span class="p">[</span><span class="s1">&#39;CA&#39;</span><span class="p">],</span> <span class="n">ad2</span><span class="p">[</span><span class="s1">&#39;CB&#39;</span><span class="p">])]</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="c1">#Add planars to sbm object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_planars</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">planar</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">planar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">planar</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">p3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">planar</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">p4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">planar</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
            <span class="n">planar_angle</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">torsion</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[</span><span class="n">planar</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">planar_angle</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_planars</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="c1">#Store planar indexes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">planars_indexes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">planar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                         <span class="n">planar</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                         <span class="n">planar</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                         <span class="n">planar</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="system.readContactFile"><a class="viewcode-back" href="../../index.html#core.models.system.readContactFile">[docs]</a>    <span class="k">def</span> <span class="nf">readContactFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contact_file</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads a file to add native contact information to the sbmOpenMM system class.</span>
<span class="sd">        The file format can be &#39;smog&#39; like (i.e. 4 columns) or &#39;2column&#39; like</span>
<span class="sd">        (i.e. one column for each atom). This is auto-dected by the method.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Detect which format of contact file is being used (new formats can be added if useful)</span>
        <span class="n">file_type</span> <span class="o">=</span> <span class="n">system</span><span class="o">.</span><span class="n">_checkContactFileType</span><span class="p">(</span><span class="n">contact_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;smog&#39;</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">elif</span> <span class="n">file_type</span> <span class="o">==</span> <span class="s1">&#39;2column&#39;</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrect contact file format! Please check carefully your contact file&#39;</span><span class="p">)</span>
        
        <span class="c1">#Read contact file and add contacts to sbm object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_contacts</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">contact_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cf</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">cf</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>
                    <span class="n">c1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="n">i</span><span class="p">])</span><span class="o">-</span><span class="n">shift</span><span class="p">]</span>
                    <span class="n">c2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="n">j</span><span class="p">])</span><span class="o">-</span><span class="n">shift</span><span class="p">]</span>
                    <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">c1</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">[</span><span class="n">c2</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">contact_length</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">bond</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">contact_length</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">n_contacts</span> <span class="o">+=</span> <span class="mi">1</span>
                    
                    <span class="c1">#Store contact indexes</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">contacts_indexes</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">c1</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                  <span class="n">c2</span><span class="o">.</span><span class="n">index</span><span class="p">))</span></div>
                
    <span class="c1">## Functions for setting force specific parameters ##</span>
    
<div class="viewcode-block" id="system.setBondParameters"><a class="viewcode-back" href="../../index.html#core.models.system.setBondParameters">[docs]</a>    <span class="k">def</span> <span class="nf">setBondParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bond_parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the harmonic bond constant force parameters. The input can be </span>
<span class="sd">        a float, to set the same parameter for all force interactions, or </span>
<span class="sd">        a list, to define a unique parameter for each force interaction.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        bond_parameters : float or list</span>
<span class="sd">            Parameter(s) to set up for the harmonic bond forces. </span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">system</span><span class="o">.</span><span class="n">_setParameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">,</span> <span class="n">bond_parameters</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="system.setAngleParameters"><a class="viewcode-back" href="../../index.html#core.models.system.setAngleParameters">[docs]</a>    <span class="k">def</span> <span class="nf">setAngleParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">angle_parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the harmonic angle constant force parameters. The input can </span>
<span class="sd">        be a float, to set the same parameter for all force interactions, </span>
<span class="sd">        or a list, to define a unique parameter for each force interaction. </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        angle_parameters : float or list</span>
<span class="sd">            Parameter(s) to set up for the harmonic angle forces. </span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">system</span><span class="o">.</span><span class="n">_setParameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">,</span> <span class="n">angle_parameters</span><span class="p">)</span></div>
                
<div class="viewcode-block" id="system.setProperTorsionParameters"><a class="viewcode-back" href="../../index.html#core.models.system.setProperTorsionParameters">[docs]</a>    <span class="k">def</span> <span class="nf">setProperTorsionParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">torsion_parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the periodic torsion constant force parameters. The input can </span>
<span class="sd">        be a float, to set the same parameter for all force interactions, </span>
<span class="sd">        or a list, to define a unique parameter for each force interaction. </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        torsion_parameters : float or list</span>
<span class="sd">            Parameter(s) to set up for the periodic torsion forces. </span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">system</span><span class="o">.</span><span class="n">_setParameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">torsions</span><span class="p">,</span> <span class="n">torsion_parameters</span><span class="p">)</span></div>
                
<div class="viewcode-block" id="system.setImproperParameters"><a class="viewcode-back" href="../../index.html#core.models.system.setImproperParameters">[docs]</a>    <span class="k">def</span> <span class="nf">setImproperParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">improper_parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the harmonic torsion constant force parameters for impropers. </span>
<span class="sd">        The input can be a float, to set the same parameter for all force </span>
<span class="sd">        interactions, or a list, to define a unique paremater for each force </span>
<span class="sd">        interaction.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        improper_parameters : float or list</span>
<span class="sd">            Parameter(s) to set up for the harmonic torsion force parameters </span>
<span class="sd">            for impropers.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">system</span><span class="o">.</span><span class="n">_setParameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">impropers</span><span class="p">,</span> <span class="n">improper_parameters</span><span class="p">)</span></div>
                
<div class="viewcode-block" id="system.setPlanarParameters"><a class="viewcode-back" href="../../index.html#core.models.system.setPlanarParameters">[docs]</a>    <span class="k">def</span> <span class="nf">setPlanarParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">planar_parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the harmonic torsion constant force parameters for planars. </span>
<span class="sd">        The input can be a float, to set the same parameter for all force </span>
<span class="sd">        interactions, or a list, to define a unique parameter for each force </span>
<span class="sd">        interaction.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        planar_parameters : float or list</span>
<span class="sd">            Parameter(s) to set up for the harmonic torsion force parameters </span>
<span class="sd">            for planars.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">system</span><span class="o">.</span><span class="n">_setParameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">,</span> <span class="n">planar_parameters</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="system.setNativeContactParameters"><a class="viewcode-back" href="../../index.html#core.models.system.setNativeContactParameters">[docs]</a>    <span class="k">def</span> <span class="nf">setNativeContactParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contact_parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the native interactions constant force parameters for native </span>
<span class="sd">        contacts. The input can be a float, to set the same parameter for </span>
<span class="sd">        all force interactions, or a list, to define a unique parameter </span>
<span class="sd">        for each force interaction.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        contact_parameters : float or list</span>
<span class="sd">            Parameter(s) to set up for the native interaction force for </span>
<span class="sd">            native contacts. </span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">system</span><span class="o">.</span><span class="n">_setParameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">,</span> <span class="n">contact_parameters</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="system.setParticlesMasses"><a class="viewcode-back" href="../../index.html#core.models.system.setParticlesMasses">[docs]</a>    <span class="k">def</span> <span class="nf">setParticlesMasses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">particles_mass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the mass of the particles in the system. The input can be a </span>
<span class="sd">        float, to set the same mass for all particles, or a list, to define </span>
<span class="sd">        a unique mass for each particle.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        particles_mass : float or list</span>
<span class="sd">            Mass(es) values to add for the particles in the sbmOpenMM system class.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">particles_mass</span> <span class="o">=</span> <span class="n">particles_mass</span></div>
    
    <span class="c1">## Functions for creating force objects with defined parameters ##</span>
    
<div class="viewcode-block" id="system.addHarmonicBondForces"><a class="viewcode-back" href="../../index.html#core.models.system.addHarmonicBondForces">[docs]</a>    <span class="k">def</span> <span class="nf">addHarmonicBondForces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an openmm.HarmonicBondForce() object with the bonds and </span>
<span class="sd">        parameters setted up in the &quot;bonds&quot; dictionary attribute. The force object </span>
<span class="sd">        is stored at the &quot;harmonicBondForce&quot; attribute.</span>
<span class="sd">        </span>
<span class="sd">        The force parameters must be contained in self.bonds as follows:</span>
<span class="sd">        self.bonds is a dictionary:</span>
<span class="sd">            - The keys are 2-tuples for two atom items in self.topology.atoms attribute.</span>
<span class="sd">            - The values are a 2-tuple of parameters in the following order:</span>
<span class="sd">                first  -&gt; bond0 (quantity)</span>
<span class="sd">                second -&gt; k (float)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">harmonicBondForce</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">HarmonicBondForce</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">harmonicBondForce</span><span class="o">.</span><span class="n">addBond</span><span class="p">(</span><span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                           <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="n">bond</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="n">bond</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span></div>
    
<div class="viewcode-block" id="system.addHarmonicAngleForces"><a class="viewcode-back" href="../../index.html#core.models.system.addHarmonicAngleForces">[docs]</a>    <span class="k">def</span> <span class="nf">addHarmonicAngleForces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an openmm.HarmonicAngleForce() object with the angles and </span>
<span class="sd">        parameters setted up in the &quot;angles&quot; attribute. The force object </span>
<span class="sd">        is stored at the &quot;harmonicAngleForce&quot; attribute.</span>
<span class="sd">        </span>
<span class="sd">        The force parameters must be contained in self.angles as follows:</span>
<span class="sd">        self.angles is dictionary:</span>
<span class="sd">            - The keys are 3-tuples for three atoms in self.topology.atoms attribute.</span>
<span class="sd">            - The values are a 2-tuple of parameters in the following order:</span>
<span class="sd">                first  -&gt; angle0 (quantity)</span>
<span class="sd">                second -&gt; k (float)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">harmonicAngleForce</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">HarmonicAngleForce</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">harmonicAngleForce</span><span class="o">.</span><span class="n">addAngle</span><span class="p">(</span><span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                            <span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                            <span class="n">angle</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">angle</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                            <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">angle</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span></div>
            
<div class="viewcode-block" id="system.addPeriodicTorsionForces"><a class="viewcode-back" href="../../index.html#core.models.system.addPeriodicTorsionForces">[docs]</a>    <span class="k">def</span> <span class="nf">addPeriodicTorsionForces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an openmm.CustomTorsionForce() object with the torsions </span>
<span class="sd">        and parameters setted up in the &quot;torsions&quot; attribute. The custom </span>
<span class="sd">        torsion force is initilized with the formula: </span>
<span class="sd">        </span>
<span class="sd">        energy = k*(1-cos(theta-theta0)+0.5*(1-cos(3*(theta-theta0))))</span>
<span class="sd">        </span>
<span class="sd">        The force object is stored at the &quot;periodicTorsionForce&quot; attribute.</span>
<span class="sd">        </span>
<span class="sd">        The force parameters must be contained in self.torsions as follows:</span>
<span class="sd">        self.torsions is a dictionary:</span>
<span class="sd">            - The keys are tuples for four atoms in self.topology.atoms attribute.</span>
<span class="sd">            - The values are a tuple of parameters in the following order:</span>
<span class="sd">                first  -&gt; theta0 (quantity)</span>
<span class="sd">                second -&gt; k (float)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">energy_function</span> <span class="o">=</span> <span class="s2">&quot;k*(1-cos(theta-theta0)+0.5*(1-cos(3*(theta-theta0))))&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodicTorsionForce</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">CustomTorsionForce</span><span class="p">(</span><span class="n">energy_function</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodicTorsionForce</span><span class="o">.</span><span class="n">addPerTorsionParameter</span><span class="p">(</span><span class="s1">&#39;theta0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodicTorsionForce</span><span class="o">.</span><span class="n">addPerTorsionParameter</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">torsion</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">torsions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">periodicTorsionForce</span><span class="o">.</span><span class="n">addTorsion</span><span class="p">(</span><span class="n">torsion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                 <span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                 <span class="n">torsion</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                 <span class="n">torsion</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">torsions</span><span class="p">[</span><span class="n">torsion</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">torsions</span><span class="p">[</span><span class="n">torsion</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span></div>
            
<div class="viewcode-block" id="system.addGeneralPeriodicTorsionForces"><a class="viewcode-back" href="../../index.html#core.models.system.addGeneralPeriodicTorsionForces">[docs]</a>    <span class="k">def</span> <span class="nf">addGeneralPeriodicTorsionForces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an openmm.CustomTorsionForce() object with the torsions </span>
<span class="sd">        and parameters setted up in the &quot;torsions&quot; attribute. The custom </span>
<span class="sd">        torsion force is initilized with the formula: </span>
<span class="sd">        </span>
<span class="sd">        energy = k*(1+cos(n*(theta-theta0)))</span>
<span class="sd">        </span>
<span class="sd">        The force object is stored at the &quot;generalPeriodicTorsionForce&quot; attribute.</span>
<span class="sd">        </span>
<span class="sd">        The force parameters must be contained in self.torsions as follows:</span>
<span class="sd">        self.torsions is a dictionary:</span>
<span class="sd">            - The keys are tuples for four atoms in self.topology.atoms attribute.</span>
<span class="sd">            - The values are a list with the parameters as items:</span>
<span class="sd">              Each item is a tuple containing:</span>
<span class="sd">                first  -&gt; theta0 (quantity)</span>
<span class="sd">                second -&gt; k (float)</span>
<span class="sd">                third -&gt; n (int)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">energy_function</span> <span class="o">=</span> <span class="s1">&#39;k*(1+cos(n*(theta-theta0)))&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">generalPeriodicTorsionForce</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">CustomTorsionForce</span><span class="p">(</span><span class="n">energy_function</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generalPeriodicTorsionForce</span><span class="o">.</span><span class="n">addPerTorsionParameter</span><span class="p">(</span><span class="s1">&#39;theta0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generalPeriodicTorsionForce</span><span class="o">.</span><span class="n">addPerTorsionParameter</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generalPeriodicTorsionForce</span><span class="o">.</span><span class="n">addPerTorsionParameter</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">torsion</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">torsions</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">torsions</span><span class="p">[</span><span class="n">torsion</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generalPeriodicTorsionForce</span><span class="o">.</span><span class="n">addTorsion</span><span class="p">(</span><span class="n">torsion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                     <span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                     <span class="n">torsion</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                     <span class="n">torsion</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                    <span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                                     <span class="n">t</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span></div>
            
<div class="viewcode-block" id="system.addHarmonicImproperForces"><a class="viewcode-back" href="../../index.html#core.models.system.addHarmonicImproperForces">[docs]</a>    <span class="k">def</span> <span class="nf">addHarmonicImproperForces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an openmm.CustomTorsionForce() object with the torsions </span>
<span class="sd">        and parameters setted up in the &quot;impropers&quot; attribute. The custom </span>
<span class="sd">        torsion force is initilized with the formula: </span>
<span class="sd">        </span>
<span class="sd">        energy = 0.5*k*dtheta_torus^2</span>
<span class="sd">        dtheta_torus = dtheta - floor(dtheta/(2*pi)+0.5)*(2*pi)</span>
<span class="sd">        dtheta = theta - theta0</span>
<span class="sd">        pi = np.pi</span>
<span class="sd">        </span>
<span class="sd">        The force object is stored at the &quot;harmonicImproperForce&quot; attribute.</span>
<span class="sd">        </span>
<span class="sd">        The force parameters must be contained in self.torsions as follows:</span>
<span class="sd">        self.torsions is a dictionary:</span>
<span class="sd">            - The keys are tuples for four atoms in self.topology.atoms attribute.</span>
<span class="sd">            - The values are a tuple of parameters in the following order:</span>
<span class="sd">                first  -&gt; theta0 (quantity)</span>
<span class="sd">                second -&gt; k (float)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">energy_function</span> <span class="o">=</span> <span class="s1">&#39;0.5*k*dtheta_torus^2;&#39;</span>
        <span class="n">energy_function</span> <span class="o">+=</span> <span class="s1">&#39;dtheta_torus = dtheta - floor(dtheta/(2*pi)+0.5)*(2*pi);&#39;</span>
        <span class="n">energy_function</span> <span class="o">+=</span> <span class="s1">&#39;dtheta = theta - theta0;&#39;</span>
        <span class="n">energy_function</span> <span class="o">+=</span> <span class="s1">&#39;pi = </span><span class="si">%f</span><span class="s1">;&#39;</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">harmonicImproperForce</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">CustomTorsionForce</span><span class="p">(</span><span class="n">energy_function</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">harmonicImproperForce</span><span class="o">.</span><span class="n">addPerTorsionParameter</span><span class="p">(</span><span class="s1">&#39;theta0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">harmonicImproperForce</span><span class="o">.</span><span class="n">addPerTorsionParameter</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">improper</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">impropers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">harmonicImproperForce</span><span class="o">.</span><span class="n">addTorsion</span><span class="p">(</span><span class="n">improper</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                 <span class="n">improper</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                 <span class="n">improper</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                 <span class="n">improper</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">impropers</span><span class="p">[</span><span class="n">improper</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">impropers</span><span class="p">[</span><span class="n">improper</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span></div>
            
<div class="viewcode-block" id="system.addHarmonicPlanarForces"><a class="viewcode-back" href="../../index.html#core.models.system.addHarmonicPlanarForces">[docs]</a>    <span class="k">def</span> <span class="nf">addHarmonicPlanarForces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an openmm.CustomTorsionForce() object with the torsions </span>
<span class="sd">        and parameters setted up in the &quot;planars&quot; attribute. The custom </span>
<span class="sd">        torsion force is initilized with the formula: </span>
<span class="sd">        </span>
<span class="sd">        energy = 0.5*k*dtheta_torus^2</span>
<span class="sd">        dtheta_torus = dtheta - floor(dtheta/(2*pi)+0.5)*(2*pi)</span>
<span class="sd">        dtheta = theta - theta0</span>
<span class="sd">        pi = np.pi</span>
<span class="sd">        </span>
<span class="sd">        The force object is stored at the &quot;harmonicPlanarForce&quot; attribute.</span>
<span class="sd">        </span>
<span class="sd">        The force parameters must be contained in self.torsions as follows:</span>
<span class="sd">        self.torsions is a dictionary:</span>
<span class="sd">            - The keys are tuples for four atoms in self.topology.atoms attribute.</span>
<span class="sd">            - The values are a tuple of parameters in the following order:</span>
<span class="sd">                first  -&gt; theta0 (quantity)</span>
<span class="sd">                second -&gt; k (float)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">energy_function</span> <span class="o">=</span> <span class="s1">&#39;0.5*k*dtheta_torus^2;&#39;</span>
        <span class="n">energy_function</span> <span class="o">+=</span> <span class="s1">&#39;dtheta_torus = dtheta - floor(dtheta/(2*pi)+0.5)*(2*pi);&#39;</span>
        <span class="n">energy_function</span> <span class="o">+=</span> <span class="s1">&#39;dtheta = theta - theta0;&#39;</span>
        <span class="n">energy_function</span> <span class="o">+=</span> <span class="s1">&#39;pi = </span><span class="si">%f</span><span class="s1">;&#39;</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">harmonicPlanarForce</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">CustomTorsionForce</span><span class="p">(</span><span class="n">energy_function</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">harmonicPlanarForce</span><span class="o">.</span><span class="n">addPerTorsionParameter</span><span class="p">(</span><span class="s1">&#39;theta0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">harmonicPlanarForce</span><span class="o">.</span><span class="n">addPerTorsionParameter</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">planar</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">harmonicPlanarForce</span><span class="o">.</span><span class="n">addTorsion</span><span class="p">(</span><span class="n">planar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                              <span class="n">planar</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                              <span class="n">planar</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                              <span class="n">planar</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[</span><span class="n">planar</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[</span><span class="n">planar</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span></div>
            
<div class="viewcode-block" id="system.addLJ12_6ContactForces"><a class="viewcode-back" href="../../index.html#core.models.system.addLJ12_6ContactForces">[docs]</a>    <span class="k">def</span> <span class="nf">addLJ12_6ContactForces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an openmm.CustomBondForce() object with the bonds and </span>
<span class="sd">        parameters setted up in the &quot;contacts&quot; attribute. The custom </span>
<span class="sd">        bond force is initilized with the formula:</span>
<span class="sd">        </span>
<span class="sd">        energy = epsilon*((sigma/r)^12-2*(sigma/r)^6)</span>
<span class="sd">        </span>
<span class="sd">        The force object is stored at the &quot;lj12_6contactForce&quot; attribute.</span>
<span class="sd">        </span>
<span class="sd">        The force parameters must be contained in self.contacts as follows:</span>
<span class="sd">        self.contacts is a dictionary:</span>
<span class="sd">            - The keys are tuples for two atoms in self.topology.atoms attribute.</span>
<span class="sd">            - The values are a tuple of parameters in the following order:</span>
<span class="sd">                first  -&gt; sigma (quantity)</span>
<span class="sd">                second -&gt; epsilon (float)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Collect the number of parametes given for each contact in the contact set</span>
        <span class="n">parameters_length</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        
        <span class="c1">#If any contact has 2 parameters create a LJ potential</span>
        <span class="k">if</span> <span class="mi">2</span> <span class="ow">in</span> <span class="n">parameters_length</span><span class="p">:</span>
            <span class="n">energy_function</span> <span class="o">=</span> <span class="s1">&#39;epsilon*((sigma/r)^12-2*(sigma/r)^6)&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lj12_6contactForce</span> <span class="o">=</span> <span class="n">CustomBondForce</span><span class="p">(</span><span class="n">energy_function</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lj12_6contactForce</span><span class="o">.</span><span class="n">addPerBondParameter</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lj12_6contactForce</span><span class="o">.</span><span class="n">addPerBondParameter</span><span class="p">(</span><span class="s1">&#39;epsilon&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">contact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lj12_6contactForce</span><span class="o">.</span><span class="n">addBond</span><span class="p">(</span><span class="n">contact</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                    <span class="n">contact</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                    <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span></div>

<div class="viewcode-block" id="system.addLJ12_10ContactForces"><a class="viewcode-back" href="../../index.html#core.models.system.addLJ12_10ContactForces">[docs]</a>    <span class="k">def</span> <span class="nf">addLJ12_10ContactForces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an openmm.CustomBondForce() object with the bonds and </span>
<span class="sd">        parameters setted up in the &quot;contacts&quot; attribute. The custom </span>
<span class="sd">        bond force is initilized with the formula:</span>
<span class="sd">        </span>
<span class="sd">        energy = epsilon*(5*(sigma/r)^12-6*(sigma/r)^10)</span>
<span class="sd">        </span>
<span class="sd">        The force object is stored at the &quot;lj12_10contactForce&quot; attribute.</span>
<span class="sd">        </span>
<span class="sd">        The force parameters must be contained in self.contacts as follows:</span>
<span class="sd">        self.contacts is a dictionary:</span>
<span class="sd">            - The keys are tuples for two atoms in self.topology.atoms attribute.</span>
<span class="sd">            - The values are a tuple of parameters in the following order:</span>
<span class="sd">                first  -&gt; sigma (quantity)</span>
<span class="sd">                second -&gt; epsilon (float)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Collect the number of parametes given for each contact in the contact set</span>
        <span class="n">parameters_length</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        
        <span class="c1">#If any contact has 2 parameters create a LJ potential</span>
        <span class="k">if</span> <span class="mi">2</span> <span class="ow">in</span> <span class="n">parameters_length</span><span class="p">:</span>
            <span class="n">energy_function</span> <span class="o">=</span> <span class="s1">&#39;epsilon*(5*(sigma/r)^12-6*(sigma/r)^10)&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lj12_10contactForce</span> <span class="o">=</span> <span class="n">CustomBondForce</span><span class="p">(</span><span class="n">energy_function</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lj12_10contactForce</span><span class="o">.</span><span class="n">addPerBondParameter</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lj12_10contactForce</span><span class="o">.</span><span class="n">addPerBondParameter</span><span class="p">(</span><span class="s1">&#39;epsilon&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">contact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lj12_10contactForce</span><span class="o">.</span><span class="n">addBond</span><span class="p">(</span><span class="n">contact</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                     <span class="n">contact</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span></div>
                    
<div class="viewcode-block" id="system.addLJ12_10_6ContactForces"><a class="viewcode-back" href="../../index.html#core.models.system.addLJ12_10_6ContactForces">[docs]</a>    <span class="k">def</span> <span class="nf">addLJ12_10_6ContactForces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an openmm.CustomBondForce() object with the bonds and </span>
<span class="sd">        parameters setted up in the &quot;contacts&quot; attribute. The custom </span>
<span class="sd">        bond force is initilized with the formula:</span>
<span class="sd">        </span>
<span class="sd">        energy = epsilon*(13*(sigma/r)^12-18*(sigma/r)^10+4*(sigma/r)^6)</span>
<span class="sd">        </span>
<span class="sd">        The force object is stored at the &quot;lj12_10_6contactForce&quot; attribute.</span>
<span class="sd">        </span>
<span class="sd">        The force parameters must be contained in self.contacts as follows:</span>
<span class="sd">        self.contacts is an ordered dictionary:</span>
<span class="sd">            - The keys are tuples for two atoms in self.topology.atoms attribute.</span>
<span class="sd">            - The values are a tuple of parameters in the following order:</span>
<span class="sd">                first  -&gt; sigma (quantity)</span>
<span class="sd">                second -&gt; epsilon (float)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Collect the number of parametes given for each contact in the contact set</span>
        <span class="n">parameters_length</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        
        <span class="c1">#If any contact has 2 parameters create a LJ potential</span>
        <span class="k">if</span> <span class="mi">2</span> <span class="ow">in</span> <span class="n">parameters_length</span><span class="p">:</span>
            <span class="n">energy_function</span> <span class="o">=</span> <span class="s1">&#39;epsilon*(13*(sigma/r)^12-18*(sigma/r)^10+4*(sigma/r)^6)&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lj12_10_6contactForce</span> <span class="o">=</span> <span class="n">CustomBondForce</span><span class="p">(</span><span class="n">energy_function</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lj12_10_6contactForce</span><span class="o">.</span><span class="n">addPerBondParameter</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lj12_10_6contactForce</span><span class="o">.</span><span class="n">addPerBondParameter</span><span class="p">(</span><span class="s1">&#39;epsilon&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">contact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lj12_10_6contactForce</span><span class="o">.</span><span class="n">addBond</span><span class="p">(</span><span class="n">contact</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                     <span class="n">contact</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                     <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span></div>
            
<div class="viewcode-block" id="system.addGaussianContactForces"><a class="viewcode-back" href="../../index.html#core.models.system.addGaussianContactForces">[docs]</a>    <span class="k">def</span> <span class="nf">addGaussianContactForces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an openmm.CustomBondForce() object with the equilibrium </span>
<span class="sd">        distances and parameters setted up in the &quot;contacts&quot; attribute. </span>
<span class="sd">        Two forces are created according to the number of parameters given:</span>
<span class="sd">        </span>
<span class="sd">        If three parameters are given the custom bond force is initilized </span>
<span class="sd">        with the formula:</span>
<span class="sd">        </span>
<span class="sd">        energy = epsilon*((1+(r0/r)^12)*(1-exp(-25*log(2)*(r-r0)^2/(r0*r0)))-1)</span>
<span class="sd">        </span>
<span class="sd">        The force object is stored at the &quot;singleGaussianContactForce&quot; attribute.</span>
<span class="sd">        </span>
<span class="sd">        The force parameters must be contained in self.contacts as follows:</span>
<span class="sd">        self.contacts is a dictionary:</span>
<span class="sd">            - The keys are tuples for tww atoms in self.topology.atoms attribute.</span>
<span class="sd">            - The values are a tuple of parameters in the following order:</span>
<span class="sd">                first  -&gt; rex (float)</span>
<span class="sd">                second -&gt; r0 (quantity)</span>
<span class="sd">                third -&gt; epsilon (float)</span>
<span class="sd">        </span>
<span class="sd">        If four parameters are given the custom bond force is initilized </span>
<span class="sd">        with the formula:</span>
<span class="sd">        </span>
<span class="sd">        energy = epsilon*((1+(r0/r)^12)*(1-exp(-25*log(2)*(r-r0)^2/(r0*r0)))*</span>
<span class="sd">                (1-exp(-25*log(2)*(r-r1)^2/(r1*r1)))-1)</span>
<span class="sd">        </span>
<span class="sd">        The force object is stored at the &quot;doubleGaussianContactForce&quot; attribute.</span>
<span class="sd">        </span>
<span class="sd">        The force parameters must be contained in self.contacts as follows:</span>
<span class="sd">        self.contacts is a dictionary:</span>
<span class="sd">            - The keys are tuples for two atoms in self.topology.atoms attribute.</span>
<span class="sd">            - The values are a tuple of parameters in the following order:</span>
<span class="sd">                first  -&gt; rex (float)</span>
<span class="sd">                second -&gt; r0 (quantity)</span>
<span class="sd">                second -&gt; r1 (quantity)</span>
<span class="sd">                third -&gt; epsilon (float)</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Collect the number of parametes given for each contact in the contact set</span>
        <span class="n">parameters_length</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        
        <span class="c1">#If any contact has 3 parameters create a single minimum gaussian potential</span>
        <span class="k">if</span> <span class="mi">3</span> <span class="ow">in</span> <span class="n">parameters_length</span><span class="p">:</span>
            <span class="n">energy_function</span> <span class="o">=</span> <span class="s1">&#39;epsilon*((1+(rex/r)^12)*&#39;</span>
            <span class="n">energy_function</span> <span class="o">+=</span> <span class="s1">&#39;(1-exp(-25*log(2)*(r-r0)^2/(r0*r0)))-1)&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">singleGaussianContactForce</span> <span class="o">=</span> <span class="n">CustomBondForce</span><span class="p">(</span><span class="n">energy_function</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">singleGaussianContactForce</span><span class="o">.</span><span class="n">addPerBondParameter</span><span class="p">(</span><span class="s1">&#39;rex&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">singleGaussianContactForce</span><span class="o">.</span><span class="n">addPerBondParameter</span><span class="p">(</span><span class="s1">&#39;r0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">singleGaussianContactForce</span><span class="o">.</span><span class="n">addPerBondParameter</span><span class="p">(</span><span class="s1">&#39;epsilon&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">contact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">singleGaussianContactForce</span><span class="o">.</span><span class="n">addBond</span><span class="p">(</span><span class="n">contact</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                            <span class="n">contact</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
                    
        <span class="c1">#If any contact has 4 parameters create a double minimum gaussian potential</span>
        <span class="k">if</span> <span class="mi">4</span> <span class="ow">in</span> <span class="n">parameters_length</span><span class="p">:</span>
            <span class="n">energy_function</span> <span class="o">=</span> <span class="s1">&#39;epsilon*((1+(rex/r)^12)*&#39;</span>
            <span class="n">energy_function</span> <span class="o">+=</span> <span class="s1">&#39;(1-exp(-25*log(2)*(r-r0)^2/(r0*r0)))*&#39;</span>
            <span class="n">energy_function</span> <span class="o">+=</span> <span class="s1">&#39;(1-exp(-25*log(2)*(r-r1)^2/(r1*r1)))-1)&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doubleGaussianContactForce</span> <span class="o">=</span> <span class="n">CustomBondForce</span><span class="p">(</span><span class="n">energy_function</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doubleGaussianContactForce</span><span class="o">.</span><span class="n">addPerBondParameter</span><span class="p">(</span><span class="s1">&#39;rex&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doubleGaussianContactForce</span><span class="o">.</span><span class="n">addPerBondParameter</span><span class="p">(</span><span class="s1">&#39;r0&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doubleGaussianContactForce</span><span class="o">.</span><span class="n">addPerBondParameter</span><span class="p">(</span><span class="s1">&#39;r1&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doubleGaussianContactForce</span><span class="o">.</span><span class="n">addPerBondParameter</span><span class="p">(</span><span class="s1">&#39;epsilon&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">contact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">doubleGaussianContactForce</span><span class="o">.</span><span class="n">addBond</span><span class="p">(</span><span class="n">contact</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                            <span class="n">contact</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                                                            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                                            <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span></div>

            
<div class="viewcode-block" id="system.addLJRepulsionForces"><a class="viewcode-back" href="../../index.html#core.models.system.addLJRepulsionForces">[docs]</a>    <span class="k">def</span> <span class="nf">addLJRepulsionForces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bonded_exclusions_index</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an openmm.CustomNonbondedForce() object with the parameters </span>
<span class="sd">        sigma and epsilon given to this method. The custom non-bonded force</span>
<span class="sd">        is initilized with the formula:</span>
<span class="sd">        </span>
<span class="sd">        energy = &#39;epsilon*(sigma/r)^12; sigma=0.5*(sigma1+sigma2)&#39;</span>
<span class="sd">        </span>
<span class="sd">        The method adds exclusions for bonded atoms up until &#39;bonded_exclusions_index&#39; </span>
<span class="sd">        bond orders (default 3) and also for all the pairs defined in the &#39;contacts&#39; attribute. </span>
<span class="sd">        The force object is stored at the &quot;ljRepulsionForce&quot; attribute.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        epsilon : float</span>
<span class="sd">            Value of the epsilon constant in the energy function. </span>
<span class="sd">        sigma : float or list </span>
<span class="sd">            Value of the sigma constant (in nm) in the energy function. If float the</span>
<span class="sd">            same sigma value is used for every particle. If list a unique </span>
<span class="sd">            parameter is given for each particle.</span>
<span class="sd">        cutoff : float</span>
<span class="sd">            The cutoff distance (in nm) being used for the nonbonded interactions.</span>
<span class="sd">        bonded_exclusions_index : int</span>
<span class="sd">            Specified number of bonds to consider when adding non-bonded exclusions.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">rf_epsilon</span> <span class="o">=</span> <span class="n">epsilon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rf_sigma</span> <span class="o">=</span> <span class="n">sigma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rf_cutoff</span> <span class="o">=</span> <span class="n">cutoff</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rf_epsilon</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rf_sigma</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rf_sigma</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">sigma</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cutoff</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rf_cutoff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cutoff</span><span class="p">)</span>
        
        <span class="n">energy_function</span> <span class="o">=</span> <span class="s1">&#39;epsilon*(sigma/r)^12; sigma=0.5*(sigma1+sigma2)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ljRepulsionForce</span> <span class="o">=</span> <span class="n">CustomNonbondedForce</span><span class="p">(</span><span class="n">energy_function</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ljRepulsionForce</span><span class="o">.</span><span class="n">addGlobalParameter</span><span class="p">(</span><span class="s1">&#39;epsilon&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rf_epsilon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ljRepulsionForce</span><span class="o">.</span><span class="n">addPerParticleParameter</span><span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rf_sigma</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ljRepulsionForce</span><span class="o">.</span><span class="n">addParticle</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rf_sigma</span><span class="p">,))</span>
                
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rf_sigma</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_atoms</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rf_sigma</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ljRepulsionForce</span><span class="o">.</span><span class="n">addParticle</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rf_sigma</span><span class="p">[</span><span class="n">i</span><span class="p">],))</span>
            
        <span class="c1">#Add bonded exclusions</span>
        <span class="n">bonded_exclusions</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ljRepulsionForce</span><span class="o">.</span><span class="n">createExclusionsFromBonds</span><span class="p">(</span><span class="n">bonded_exclusions</span><span class="p">,</span> <span class="n">bonded_exclusions_index</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclusions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ljRepulsionForce</span><span class="o">.</span><span class="n">getNumExclusions</span><span class="p">()):</span>
            <span class="n">pair</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ljRepulsionForce</span><span class="o">.</span><span class="n">getExclusionParticles</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exclusions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
            
        <span class="c1">#Add contacts exclusions</span>
        <span class="n">contact_exclusions</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">]</span>
        <span class="c1">#Remove already excluded pairs (from bonded exclusions)</span>
        <span class="c1">#to avoid &#39;Multiple exclusions are specified&#39; error</span>
        <span class="n">contact_exclusions</span> <span class="o">=</span> <span class="p">[</span><span class="n">pair</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">contact_exclusions</span> <span class="k">if</span> <span class="n">pair</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">exclusions</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ljRepulsionForce</span><span class="o">.</span><span class="n">createExclusionsFromBonds</span><span class="p">(</span><span class="n">contact_exclusions</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="c1">#Add all exclusion pairs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclusions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ljRepulsionForce</span><span class="o">.</span><span class="n">getNumExclusions</span><span class="p">()):</span>
            <span class="n">pair</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ljRepulsionForce</span><span class="o">.</span><span class="n">getExclusionParticles</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exclusions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ljRepulsionForce</span><span class="o">.</span><span class="n">setCutoffDistance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rf_cutoff</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="system.groupTorsionsbyBBAndSC"><a class="viewcode-back" href="../../index.html#core.models.system.groupTorsionsbyBBAndSC">[docs]</a>    <span class="k">def</span> <span class="nf">groupTorsionsbyBBAndSC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Classifies the torsions into backbone or sidechain, based on the atoms </span>
<span class="sd">        present in each torsion definition.</span>
<span class="sd">        </span>
<span class="sd">        The classification is stored in the &#39;torsions_type&#39; dictionary attribute.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Classify atoms in backbone or sidechain atoms</span>
        <span class="n">uniqueAtoms</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">atoms</span><span class="p">():</span>
            <span class="n">uniqueAtoms</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backboneAtoms</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;CA&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;OXT, H, 1H, 2H, 3H&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sidechainAtoms</span> <span class="o">=</span> <span class="n">uniqueAtoms</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">backboneAtoms</span>
        
        <span class="c1">#Group torsions by their middle bond atoms</span>
        <span class="k">for</span> <span class="n">torsion</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">torsions</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">torsions_group</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">torsions_group</span><span class="p">[(</span><span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">torsions_group</span><span class="p">[(</span><span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">torsion</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">torsions_group</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">torsions_group</span><span class="p">[(</span><span class="n">torsion</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">torsions_group</span><span class="p">[(</span><span class="n">torsion</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1">#Classify torsions in backbone or sidechain torsion according to middle atoms</span>
        <span class="k">for</span> <span class="n">torsion</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">torsions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">torsions_type</span><span class="p">[</span><span class="n">torsion</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;BB&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">torsions_type</span><span class="p">[</span><span class="n">torsion</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;BB&#39;</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sidechainAtoms</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">torsions_type</span><span class="p">[</span><span class="n">torsion</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SC&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">torsions_type</span><span class="p">[</span><span class="n">torsion</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SC&#39;</span>
                    <span class="k">break</span>
        
        <span class="c1">#Count the number of backbone and sidechin torsions with unique middle bond atoms.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_torsions</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">torsions_group</span><span class="p">])</span><span class="o">/</span><span class="mf">4.0</span><span class="p">)</span></div>
    
    <span class="c1">## Functions for generating default parameters for AA default forcefield ##</span>
    
<div class="viewcode-block" id="system.getAATorsionParameters"><a class="viewcode-back" href="../../index.html#core.models.system.getAATorsionParameters">[docs]</a>    <span class="k">def</span> <span class="nf">getAATorsionParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_by_bb_and_sc</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the torsion force field parameters by distributing the </span>
<span class="sd">        total torsional energy equally among all the torsions. Optionally,</span>
<span class="sd">        uses torsional classifications, in backbone or side-chain torsions,</span>
<span class="sd">        to group the energy partition. In the last case considers that BB</span>
<span class="sd">        torsion energies are twice the value of sidechain torsion energies.</span>
<span class="sd">        </span>
<span class="sd">        The energy partioned values are stored in the &#39;energy_constant&#39; </span>
<span class="sd">        attribute. It contains the entries &#39;torsion&#39; for the equally partitioned</span>
<span class="sd">        torsion energies, or &#39;BB&#39; and &#39;SC&#39; for group-partioned torsion energies.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        group_by_bb_and_sc : boolean</span>
<span class="sd">            Wheter to partion the torsional energy in backbone and side-chain </span>
<span class="sd">            groups.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        torsion_parameters : list</span>
<span class="sd">            List of the torsion force constant parameters for each torsion</span>
<span class="sd">            in the SBM system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">group_by_bb_and_sc</span><span class="p">:</span>
            <span class="c1">#Group torsions by BB and SC</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groupTorsionsbyBBAndSC</span><span class="p">()</span>
            <span class="c1">#Calculate energy partitions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">energy_constant</span><span class="p">[</span><span class="s1">&#39;torsion&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">n_atoms</span><span class="o">/</span><span class="mf">3.0</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_torsions</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">energy_constant</span><span class="p">[</span><span class="s1">&#39;SC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_constant</span><span class="p">[</span><span class="s1">&#39;torsion&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">3.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">energy_constant</span><span class="p">[</span><span class="s1">&#39;BB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">energy_constant</span><span class="p">[</span><span class="s1">&#39;torsion&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">3.0</span>
            
            <span class="n">torsion_parameters</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">torsion</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">torsions</span><span class="p">:</span>
                <span class="n">middle_bond</span> <span class="o">=</span> <span class="p">(</span><span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">torsion</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_constant</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">torsions_type</span><span class="p">[</span><span class="n">torsion</span><span class="p">]]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">torsions_group</span><span class="p">[</span><span class="n">middle_bond</span><span class="p">]</span>
                <span class="n">torsion_parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">energy_constant</span><span class="p">[</span><span class="s1">&#39;torsion&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">n_atoms</span><span class="o">/</span><span class="mf">3.0</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_torsions</span><span class="p">)</span>
            <span class="n">torsion_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_constant</span><span class="p">[</span><span class="s1">&#39;torsion&#39;</span><span class="p">]</span>
            
        <span class="k">return</span> <span class="n">torsion_parameters</span></div>
    
<div class="viewcode-block" id="system.getAANativeContactParameters"><a class="viewcode-back" href="../../index.html#core.models.system.getAANativeContactParameters">[docs]</a>    <span class="k">def</span> <span class="nf">getAANativeContactParameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the contact force field parameters by distributing the </span>
<span class="sd">        total native contact energy equally among all the contacts.</span>
<span class="sd">        </span>
<span class="sd">        The energy values are stored in the &#39;energy_constant&#39; attribute, </span>
<span class="sd">        which contains the entry &#39;C&#39; for the partitioned energy values.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        contact_parameters : list</span>
<span class="sd">            List of the native-contact force constant parameters for each </span>
<span class="sd">            native contact in the SBM system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_contacts</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Not contacts have been defined. Please check that you read correctly a contact file.&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">energy_constant</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n_atoms</span><span class="o">/</span><span class="mf">3.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">n_contacts</span>
        <span class="n">contact_parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">energy_constant</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">contact_parameters</span></div>
    
    <span class="c1">## Functions for creating OpenMM system object ##</span>
    
<div class="viewcode-block" id="system.createSystemObject"><a class="viewcode-back" href="../../index.html#core.models.system.createSystemObject">[docs]</a>    <span class="k">def</span> <span class="nf">createSystemObject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check_bond_distances</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">minimise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force_threshold</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">bond_threshold</span><span class="o">=</span><span class="mf">0.24</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an openmm.System() object using the force field parameters</span>
<span class="sd">        given to the SBM &#39;system&#39; class. It adds particles, forces and </span>
<span class="sd">        creates a force group for each force object. Optionally the method </span>
<span class="sd">        can check for large bond distances (default) and minimise the atomic </span>
<span class="sd">        positions if large forces are found in any atom (default False).</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        minimise : boolean</span>
<span class="sd">            Wheter to minimise the system if large forces are found.</span>
<span class="sd">        check_bond_distances : boolean</span>
<span class="sd">            Wheter to check for large bond distances.</span>
<span class="sd">        force_threshold : float</span>
<span class="sd">            Treshold to check for large forces.</span>
<span class="sd">        bond_threshold : float</span>
<span class="sd">            Treshold to check for large bond distances.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">check_bond_distances</span><span class="p">:</span>
            <span class="c1">#Check for large bond_distances</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkBondDistances</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">bond_threshold</span><span class="p">)</span>
        
        <span class="c1">#Add particles to system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addParticles</span><span class="p">()</span>
        
        <span class="c1">#Add created forces into the system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addSystemForces</span><span class="p">()</span>
        
        <span class="c1">#Create force group for each added force</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">setForceGroup</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        
        <span class="c1">#Check for high forces in atoms and minimise the system if necessary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkLargeForces</span><span class="p">(</span><span class="n">minimise</span><span class="o">=</span><span class="n">minimise</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">force_threshold</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="system.checkBondDistances"><a class="viewcode-back" href="../../index.html#core.models.system.checkBondDistances">[docs]</a>    <span class="k">def</span> <span class="nf">checkBondDistances</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.24</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Searches for large bond distances for the atom pairs defined in </span>
<span class="sd">        the &#39;bonds&#39; attribute. It raises an error when large bonds are found.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        threshold : float</span>
<span class="sd">            Treshold to check for large bond distances.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span> <span class="o">*</span> <span class="n">unit</span><span class="o">.</span><span class="n">nanometer</span>
        
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The bond distance between atoms &#39;</span><span class="o">+</span>                <span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; and &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; is larger &#39;</span><span class="o">+</span>
                <span class="s1">&#39;than &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; nanometers. Please check your input structure.&#39;</span><span class="p">)</span></div>
                
<div class="viewcode-block" id="system.checkLargeForces"><a class="viewcode-back" href="../../index.html#core.models.system.checkLargeForces">[docs]</a>    <span class="k">def</span> <span class="nf">checkLargeForces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">minimise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints the SBM system energies of the input configuration of the </span>
<span class="sd">        system. It optionally checks for large forces acting upon all </span>
<span class="sd">        particles in the SBM system and iteratively minimises the system</span>
<span class="sd">        configuration until no forces larger than a threshold are found.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        threshold : float</span>
<span class="sd">            Treshold to check for large forces.</span>
<span class="sd">        minimise : float</span>
<span class="sd">            Whether to iteratively minimise the system until all forces are lower or equal to </span>
<span class="sd">            the thresshold value.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">minimised</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1">#Define test simulation to extract forces</span>
        <span class="n">integrator</span> <span class="o">=</span> <span class="n">LangevinIntegrator</span><span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">unit</span><span class="o">.</span><span class="n">picosecond</span><span class="p">,</span> <span class="mf">0.0005</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">picoseconds</span><span class="p">)</span>
        <span class="n">simulation</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">)</span>
        <span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setPositions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">)</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">getForces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">getEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
        <span class="c1">#Print initial state of the system</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The Potential Energy of the system is : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">state</span><span class="o">.</span><span class="n">getPotentialEnergy</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span><span class="p">):</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">getEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">})</span><span class="o">.</span><span class="n">getPotentialEnergy</span><span class="p">()</span><span class="o">.</span><span class="n">value_in_unit</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">kilojoules_per_mole</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The &#39;</span><span class="o">+</span><span class="n">n</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Force&#39;</span><span class="p">,</span><span class="s1">&#39;Energy&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; is: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; kj/mol&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">minimise</span><span class="p">:</span>
            <span class="c1">#Find if there is an acting force larger than thresshold</span>
            <span class="c1">#Minimise the system until forces have converged</span>
            <span class="n">forces</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">([</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span><span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span>  <span class="n">state</span><span class="o">.</span><span class="n">getForces</span><span class="p">()]</span>
            <span class="n">prev_force</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">tolerance</span> <span class="o">=</span> <span class="mi">10</span>
            
            <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">forces</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">:</span>

                <span class="c1">#Write atom with largest force if not reported before </span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">forces</span><span class="p">)</span> <span class="o">!=</span> <span class="n">prev_force</span><span class="p">:</span>
                    <span class="n">atom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">forces</span><span class="p">)]</span>
                    <span class="n">residue</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">residue</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Large force </span><span class="si">%.3f</span><span class="s1"> kj/(mol nm) found in:&#39;</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">forces</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Atom: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">atom</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Name: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">atom</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Resiue: </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">residue</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">residue</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Minimising system with energy tolerance of </span><span class="si">%.1f</span><span class="s1"> kj/mol&#39;</span> <span class="o">%</span> <span class="n">tolerance</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

                <span class="n">simulation</span><span class="o">.</span><span class="n">minimizeEnergy</span><span class="p">(</span><span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">kilojoule</span><span class="o">/</span><span class="n">unit</span><span class="o">.</span><span class="n">mole</span><span class="p">)</span>
                <span class="n">minimised</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">getForces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">prev_force</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">forces</span><span class="p">)</span>
                <span class="n">forces</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">z</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span>  <span class="n">state</span><span class="o">.</span><span class="n">getForces</span><span class="p">()]</span>
                <span class="k">if</span> <span class="n">tolerance</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">tolerance</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">tolerance</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
                    <span class="n">tolerance</span> <span class="o">-=</span> <span class="mf">0.1</span>
                <span class="k">elif</span> <span class="n">tolerance</span> <span class="o">==</span> <span class="mf">0.1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The system could no be minimised at the requested convergence</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span>
                                     <span class="s1">&#39;Try to increase the force threshold value to achieve convergence.&#39;</span><span class="p">)</span>
                    

            <span class="n">state</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">getPositions</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">getEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After minimisation:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The Potential Energy of the system is : </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">state</span><span class="o">.</span><span class="n">getPotentialEnergy</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span><span class="p">):</span>
                <span class="n">energy</span> <span class="o">=</span> <span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">getState</span><span class="p">(</span><span class="n">getEnergy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">groups</span><span class="o">=</span><span class="p">{</span><span class="n">i</span><span class="p">})</span><span class="o">.</span><span class="n">getPotentialEnergy</span><span class="p">()</span><span class="o">.</span><span class="n">value_in_unit</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">kilojoules_per_mole</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The &#39;</span><span class="o">+</span><span class="n">n</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Force&#39;</span><span class="p">,</span><span class="s1">&#39;Energy&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; is: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; kj/mol&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;All forces are less than </span><span class="si">%.2f</span><span class="s1"> kj/mol/nm&#39;</span> <span class="o">%</span> <span class="n">threshold</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving minimised positions&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">getPositions</span><span class="p">()</span></div>
                
<div class="viewcode-block" id="system.addParticles"><a class="viewcode-back" href="../../index.html#core.models.system.addParticles">[docs]</a>    <span class="k">def</span> <span class="nf">addParticles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a particle to the sbmOpenMM system for each atom in it. The mass </span>
<span class="sd">        of each particle is set up with the values in the &#39;particles_mass&#39; </span>
<span class="sd">        attribute.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Set same mass for each atom</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particles_mass</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">addParticle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particles_mass</span><span class="p">)</span>
                
        <span class="c1">#Set unique masses for each atom</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particles_mass</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particles_mass</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particles_mass</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">addParticle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">particles_mass</span><span class="p">[</span><span class="n">i</span><span class="p">])</span></div>
    
<div class="viewcode-block" id="system.addSystemForces"><a class="viewcode-back" href="../../index.html#core.models.system.addSystemForces">[docs]</a>    <span class="k">def</span> <span class="nf">addSystemForces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds generated forces to the sbmOpenMM system, also adding </span>
<span class="sd">        a force group to the &#39;forceGroups&#39; attribute dictionary.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">harmonicBondForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">harmonicBondForce</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span><span class="p">[</span><span class="s1">&#39;Harmonic Bond Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">harmonicBondForce</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">harmonicAngleForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">harmonicAngleForce</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span><span class="p">[</span><span class="s1">&#39;Harmonic Angle Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">harmonicAngleForce</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodicTorsionForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">periodicTorsionForce</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span><span class="p">[</span><span class="s1">&#39;Periodic Torsion Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodicTorsionForce</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">generalPeriodicTorsionForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generalPeriodicTorsionForce</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span><span class="p">[</span><span class="s1">&#39;General Periodic Torsion Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generalPeriodicTorsionForce</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">harmonicImproperForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">harmonicImproperForce</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span><span class="p">[</span><span class="s1">&#39;Harmonic Improper Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">harmonicImproperForce</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">harmonicPlanarForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">harmonicPlanarForce</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span><span class="p">[</span><span class="s1">&#39;Harmonic Planar Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">harmonicPlanarForce</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj12_6contactForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj12_6contactForce</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span><span class="p">[</span><span class="s1">&#39;LJ 12-6 Contact Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj12_6contactForce</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj12_10contactForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj12_10contactForce</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span><span class="p">[</span><span class="s1">&#39;LJ 12-10 Contact Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj12_10contactForce</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj12_10_6contactForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lj12_10_6contactForce</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span><span class="p">[</span><span class="s1">&#39;LJ 12-10-6 Contact Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lj12_10_6contactForce</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">singleGaussianContactForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">singleGaussianContactForce</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span><span class="p">[</span><span class="s1">&#39;Single Gaussian Contact Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">singleGaussianContactForce</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">doubleGaussianContactForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doubleGaussianContactForce</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span><span class="p">[</span><span class="s1">&#39;Double Gaussian Contact Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">doubleGaussianContactForce</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ljRepulsionForce</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">addForce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ljRepulsionForce</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forceGroups</span><span class="p">[</span><span class="s1">&#39;LJ 12 Repulsion Energy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ljRepulsionForce</span></div>
    
<div class="viewcode-block" id="system.dumpPdb"><a class="viewcode-back" href="../../index.html#core.models.system.dumpPdb">[docs]</a>    <span class="k">def</span> <span class="nf">dumpPdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a PDB file containing the currently defined abmOpenMM system atoms.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        output_file : string</span>
<span class="sd">            name of the PDB output file. </span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb</span><span class="o">.</span><span class="n">writeFile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topology</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">positions</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">))</span></div>
        
<div class="viewcode-block" id="system.dumpForceFieldData"><a class="viewcode-back" href="../../index.html#core.models.system.dumpForceFieldData">[docs]</a>    <span class="k">def</span> <span class="nf">dumpForceFieldData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes a file containing the current forcefield parameters in the </span>
<span class="sd">        sbmOpenMM system.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        output_file : string</span>
<span class="sd">            name of the output file. </span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
            
            <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#### SBM Force Field Parameters ####</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span> <span class="o">!=</span> <span class="n">OrderedDict</span><span class="p">():</span>
                <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[bonds]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# </span><span class="si">%2s</span><span class="s1"> </span><span class="si">%3s</span><span class="s1"> </span><span class="si">%-6s</span><span class="s1"> </span><span class="si">%-s</span><span class="s1"> </span><span class="se">\t\t</span><span class="s1"> self.bonds[bond][1] </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;at1&#39;</span><span class="p">,</span> <span class="s1">&#39;at2&#39;</span><span class="p">,</span> <span class="s1">&#39;b0&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;at1_name&#39;</span><span class="p">,</span> <span class="s1">&#39;at2_name&#39;</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">bond</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">:</span>
                    <span class="n">atom1</span> <span class="o">=</span> <span class="n">bond</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">atom2</span> <span class="o">=</span> <span class="n">bond</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">res1</span> <span class="o">=</span> <span class="n">atom1</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">res2</span> <span class="o">=</span> <span class="n">atom2</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%.4f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom1</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                  <span class="n">atom2</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="n">bond</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span>
                                                                  <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">[</span><span class="n">bond</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                                  <span class="n">atom1</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res1</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res1</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                                                  <span class="n">atom2</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res2</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res2</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
                        
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">!=</span> <span class="n">OrderedDict</span><span class="p">():</span>
                <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[angles]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# </span><span class="si">%2s</span><span class="s1"> </span><span class="si">%3s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%-6s</span><span class="s1"> </span><span class="si">%-s</span><span class="s1"> </span><span class="se">\t</span><span class="s1">  </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;at1&#39;</span><span class="p">,</span> <span class="s1">&#39;at2&#39;</span><span class="p">,</span> <span class="s1">&#39;at3&#39;</span><span class="p">,</span> <span class="s1">&#39;a0&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;at1_name&#39;</span><span class="p">,</span> <span class="s1">&#39;at2_name&#39;</span><span class="p">,</span> <span class="s1">&#39;at3_name&#39;</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">angle</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">:</span>
                    <span class="n">atom1</span> <span class="o">=</span> <span class="n">angle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">atom2</span> <span class="o">=</span> <span class="n">angle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">atom3</span> <span class="o">=</span> <span class="n">angle</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">res1</span> <span class="o">=</span> <span class="n">atom1</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">res2</span> <span class="o">=</span> <span class="n">atom2</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">res3</span> <span class="o">=</span> <span class="n">atom3</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%.4f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom1</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                           <span class="n">atom2</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                           <span class="n">atom3</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                           <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">angle</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span>
                                                                           <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[</span><span class="n">angle</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                                           <span class="n">atom1</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res1</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res1</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                                                           <span class="n">atom2</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res2</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res2</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                                                           <span class="n">atom3</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res3</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res3</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">torsions</span> <span class="o">!=</span> <span class="n">OrderedDict</span><span class="p">():</span>
                <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[torsions]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# </span><span class="si">%2s</span><span class="s1"> </span><span class="si">%3s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%-6s</span><span class="s1"> </span><span class="si">%-s</span><span class="s1"> </span><span class="se">\t\t</span><span class="s1">  </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;at1&#39;</span><span class="p">,</span> <span class="s1">&#39;at2&#39;</span><span class="p">,</span> <span class="s1">&#39;at3&#39;</span><span class="p">,</span> <span class="s1">&#39;at4&#39;</span><span class="p">,</span> <span class="s1">&#39;t0&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;at1_name&#39;</span><span class="p">,</span> <span class="s1">&#39;at2_name&#39;</span><span class="p">,</span> <span class="s1">&#39;at3_name&#39;</span><span class="p">,</span> <span class="s1">&#39;at4_name&#39;</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">torsion</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">torsions</span><span class="p">:</span>
                    <span class="n">atom1</span> <span class="o">=</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">atom2</span> <span class="o">=</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">atom3</span> <span class="o">=</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">atom4</span> <span class="o">=</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">res1</span> <span class="o">=</span> <span class="n">atom1</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">res2</span> <span class="o">=</span> <span class="n">atom2</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">res3</span> <span class="o">=</span> <span class="n">atom3</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">res4</span> <span class="o">=</span> <span class="n">atom3</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%7.4f</span><span class="s1"> </span><span class="si">%.4f</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom1</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                                       <span class="n">atom2</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                                       <span class="n">atom3</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                                       <span class="n">atom4</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">torsions</span><span class="p">[</span><span class="n">torsion</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span>
                                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">torsions</span><span class="p">[</span><span class="n">torsion</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                                                       <span class="n">atom1</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res1</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res1</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                                                                       <span class="n">atom2</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res2</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res2</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                                                                       <span class="n">atom3</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res3</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res3</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                                                                       <span class="n">atom4</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res4</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res4</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
                        
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">impropers</span> <span class="o">!=</span> <span class="n">OrderedDict</span><span class="p">():</span>
                <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[impropers]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# </span><span class="si">%2s</span><span class="s1"> </span><span class="si">%3s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%-6s</span><span class="s1"> </span><span class="si">%-s</span><span class="s1"> </span><span class="se">\t\t</span><span class="s1">  </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;at1&#39;</span><span class="p">,</span> <span class="s1">&#39;at2&#39;</span><span class="p">,</span> <span class="s1">&#39;at3&#39;</span><span class="p">,</span> <span class="s1">&#39;at4&#39;</span><span class="p">,</span> <span class="s1">&#39;i0&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;at1_name&#39;</span><span class="p">,</span> <span class="s1">&#39;at2_name&#39;</span><span class="p">,</span> <span class="s1">&#39;at3_name&#39;</span><span class="p">,</span> <span class="s1">&#39;at4_name&#39;</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">improper</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">impropers</span><span class="p">:</span>
                    <span class="n">atom1</span> <span class="o">=</span> <span class="n">improper</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">atom2</span> <span class="o">=</span> <span class="n">improper</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">atom3</span> <span class="o">=</span> <span class="n">improper</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">atom4</span> <span class="o">=</span> <span class="n">improper</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">res1</span> <span class="o">=</span> <span class="n">atom1</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">res2</span> <span class="o">=</span> <span class="n">atom2</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">res3</span> <span class="o">=</span> <span class="n">atom3</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">res4</span> <span class="o">=</span> <span class="n">atom3</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%7.4f</span><span class="s1"> </span><span class="si">%.4f</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom1</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                                       <span class="n">atom2</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                                       <span class="n">atom3</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                                       <span class="n">atom4</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">impropers</span><span class="p">[</span><span class="n">improper</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span>
                                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">impropers</span><span class="p">[</span><span class="n">improper</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                                                       <span class="n">atom1</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res1</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res1</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                                                                       <span class="n">atom2</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res2</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res2</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                                                                       <span class="n">atom3</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res3</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res3</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                                                                       <span class="n">atom4</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res4</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res4</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
                        
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">planars</span> <span class="o">!=</span> <span class="n">OrderedDict</span><span class="p">():</span>
                <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[planars]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# </span><span class="si">%2s</span><span class="s1"> </span><span class="si">%3s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%-6s</span><span class="s1"> </span><span class="si">%-s</span><span class="s1"> </span><span class="se">\t\t</span><span class="s1">  </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;at1&#39;</span><span class="p">,</span> <span class="s1">&#39;at2&#39;</span><span class="p">,</span> <span class="s1">&#39;at3&#39;</span><span class="p">,</span> <span class="s1">&#39;at4&#39;</span><span class="p">,</span> <span class="s1">&#39;p0&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;at1_name&#39;</span><span class="p">,</span> <span class="s1">&#39;at2_name&#39;</span><span class="p">,</span> <span class="s1">&#39;at3_name&#39;</span><span class="p">,</span> <span class="s1">&#39;at4_name&#39;</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">planar</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">:</span>
                    <span class="n">atom1</span> <span class="o">=</span> <span class="n">planar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">atom2</span> <span class="o">=</span> <span class="n">planar</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">atom3</span> <span class="o">=</span> <span class="n">planar</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">atom4</span> <span class="o">=</span> <span class="n">planar</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">res1</span> <span class="o">=</span> <span class="n">atom1</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">res2</span> <span class="o">=</span> <span class="n">atom2</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">res3</span> <span class="o">=</span> <span class="n">atom3</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">res4</span> <span class="o">=</span> <span class="n">atom3</span><span class="o">.</span><span class="n">residue</span>
                    <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%7.4f</span><span class="s1"> </span><span class="si">%.4f</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom1</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                                       <span class="n">atom2</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                                       <span class="n">atom3</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                                       <span class="n">atom4</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[</span><span class="n">planar</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span>
                                                                                       <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[</span><span class="n">planar</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                                                       <span class="n">atom1</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res1</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res1</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                                                                       <span class="n">atom2</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res2</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res2</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                                                                       <span class="n">atom3</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res3</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res3</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                                                                       <span class="n">atom4</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res4</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res4</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
                        
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span> <span class="o">!=</span> <span class="n">OrderedDict</span><span class="p">():</span>
                <span class="c1">#Collect the number of parametes given for each contact in the contact set</span>
                <span class="n">parameters_length</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
                
                <span class="c1">#Write two parameters contacts</span>
                <span class="k">if</span> <span class="mi">2</span> <span class="ow">in</span> <span class="n">parameters_length</span><span class="p">:</span>
                    <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[contacts]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#Two parameters contacts</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# </span><span class="si">%2s</span><span class="s1"> </span><span class="si">%3s</span><span class="s1"> </span><span class="si">%-6s</span><span class="s1"> </span><span class="si">%-s</span><span class="s1"> </span><span class="se">\t</span><span class="s1">  </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;at1&#39;</span><span class="p">,</span> <span class="s1">&#39;at2&#39;</span><span class="p">,</span> <span class="s1">&#39;c0&#39;</span><span class="p">,</span> <span class="s1">&#39;epsilon&#39;</span><span class="p">,</span> <span class="s1">&#39;at1_name&#39;</span><span class="p">,</span> <span class="s1">&#39;at2_name&#39;</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">contact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">atom1</span> <span class="o">=</span> <span class="n">contact</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">atom2</span> <span class="o">=</span> <span class="n">contact</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">res1</span> <span class="o">=</span> <span class="n">atom1</span><span class="o">.</span><span class="n">residue</span>
                            <span class="n">res2</span> <span class="o">=</span> <span class="n">atom2</span><span class="o">.</span><span class="n">residue</span>
                            <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%.4f</span><span class="s1"> </span><span class="si">%.4f</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom1</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                          <span class="n">atom2</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                          <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span>
                                                                          <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                                                                          <span class="n">atom1</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res1</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res1</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                                                          <span class="n">atom2</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res2</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res2</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
                            
                <span class="c1">#Write three parameters contacts</span>
                <span class="k">if</span> <span class="mi">3</span> <span class="ow">in</span> <span class="n">parameters_length</span><span class="p">:</span>
                    <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#Three parameters contacts</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# </span><span class="si">%2s</span><span class="s1"> </span><span class="si">%3s</span><span class="s1"> </span><span class="si">%-6s</span><span class="s1"> </span><span class="si">%-6s</span><span class="s1"> </span><span class="si">%-s</span><span class="s1"> </span><span class="se">\t</span><span class="s1">  </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;at1&#39;</span><span class="p">,</span> <span class="s1">&#39;at2&#39;</span><span class="p">,</span> <span class="s1">&#39;excvol&#39;</span><span class="p">,</span> <span class="s1">&#39;c0&#39;</span><span class="p">,</span> <span class="s1">&#39;epsilon&#39;</span><span class="p">,</span> <span class="s1">&#39;at1_name&#39;</span><span class="p">,</span> <span class="s1">&#39;at2_name&#39;</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">contact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">atom1</span> <span class="o">=</span> <span class="n">contact</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">atom2</span> <span class="o">=</span> <span class="n">contact</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">res1</span> <span class="o">=</span> <span class="n">atom1</span><span class="o">.</span><span class="n">residue</span>
                            <span class="n">res2</span> <span class="o">=</span> <span class="n">atom2</span><span class="o">.</span><span class="n">residue</span>
                            <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%.4f</span><span class="s1"> </span><span class="si">%.4f</span><span class="s1"> </span><span class="si">%.4f</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom1</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                          <span class="n">atom2</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                          <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span>
                                                                          <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span>
                                                                          <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
                                                                          <span class="n">atom1</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res1</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res1</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                                                          <span class="n">atom2</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res2</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res2</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
                <span class="c1">#Write four parameters contacts</span>
                <span class="k">if</span> <span class="mi">4</span> <span class="ow">in</span> <span class="n">parameters_length</span><span class="p">:</span>
                    <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;#Four parameters contacts</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# </span><span class="si">%2s</span><span class="s1"> </span><span class="si">%3s</span><span class="s1"> </span><span class="si">%-6s</span><span class="s1"> </span><span class="si">%-6s</span><span class="s1"> </span><span class="si">%-6s</span><span class="s1"> </span><span class="si">%-s</span><span class="s1"> </span><span class="se">\t</span><span class="s1">  </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;at1&#39;</span><span class="p">,</span> <span class="s1">&#39;at2&#39;</span><span class="p">,</span> <span class="s1">&#39;excvol&#39;</span><span class="p">,</span> <span class="s1">&#39;c0&#39;</span><span class="p">,</span> <span class="s1">&#39;c1&#39;</span><span class="p">,</span> <span class="s1">&#39;epsilon&#39;</span><span class="p">,</span> <span class="s1">&#39;at1_name&#39;</span><span class="p">,</span> <span class="s1">&#39;at2_name&#39;</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">contact</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">])</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="n">atom1</span> <span class="o">=</span> <span class="n">contact</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="n">atom2</span> <span class="o">=</span> <span class="n">contact</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">res1</span> <span class="o">=</span> <span class="n">atom1</span><span class="o">.</span><span class="n">residue</span>
                            <span class="n">res2</span> <span class="o">=</span> <span class="n">atom2</span><span class="o">.</span><span class="n">residue</span>
                            <span class="n">ff</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%4s</span><span class="s1"> </span><span class="si">%4s</span><span class="s1"> </span><span class="si">%.4f</span><span class="s1"> </span><span class="si">%.4f</span><span class="s1"> </span><span class="si">%.4f</span><span class="s1"> </span><span class="si">%.4f</span><span class="s1"> </span><span class="se">\t</span><span class="s1"># </span><span class="si">%12s</span><span class="s1"> </span><span class="si">%12s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">atom1</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                          <span class="n">atom2</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                                          <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span>
                                                                          <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span>
                                                                          <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span>
                                                                          <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[</span><span class="n">contact</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
                                                                          <span class="n">atom1</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res1</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res1</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                                                                          <span class="n">atom2</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">res2</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">res2</span><span class="o">.</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span></div>
            
<div class="viewcode-block" id="system.loadForcefieldFromFile"><a class="viewcode-back" href="../../index.html#core.models.system.loadForcefieldFromFile">[docs]</a>    <span class="k">def</span> <span class="nf">loadForcefieldFromFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">forcefield_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads force field parameters from a force field file written by the </span>
<span class="sd">        dumpForceFieldData() method into the sbmOpenMM system.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        forcefield_file : string</span>
<span class="sd">            path to the force field file.</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#Open forcefield file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">forcefield_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading Forcefield parameters from file &#39;</span><span class="o">+</span><span class="n">forcefield_file</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;________________________________________&#39;</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">forcefield_file</span><span class="p">))</span>
            
            <span class="c1">#Initilise ff-file section booleans to 0</span>
            <span class="n">bonds</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">angles</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">torsions</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">impropers</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">planars</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">contacts</span> <span class="o">=</span> <span class="kc">False</span>
                        
            <span class="c1">#Iterate for all lines in forcefield file</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ff</span><span class="p">):</span>
                
                <span class="c1">#Ignore comment and empty lines.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="o">!=</span> <span class="p">[]:</span>
                    
                    <span class="c1">#Turn off all sections when a new is being reading.</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">):</span>
                        <span class="n">bonds</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">angles</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">torsions</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">impropers</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">planars</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">contacts</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        
                        <span class="c1">#Remove comments at the end of line</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)]</span>
                        <span class="n">ls</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        
                        <span class="c1">#Reading [bonds] section</span>
                        <span class="k">if</span> <span class="n">bonds</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;More than four parameters given in [bonds] section at line &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">line</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Less than four parameters given in [bonds] section at line &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">line</span><span class="p">)</span>
                            <span class="n">at1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">at2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">bond_length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">nanometer</span>
                            <span class="n">k</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span><span class="p">[(</span><span class="n">at1</span><span class="p">,</span><span class="n">at2</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">bond_length</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                            
                        <span class="c1">#Reading [angles] section</span>
                        <span class="k">elif</span> <span class="n">angles</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;More than five parameters given in [angles] section at line &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">line</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Less than five parameters given in [angles] section at line &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">line</span><span class="p">)</span>
                            <span class="n">at1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">at2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">at3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">angle_length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">radian</span>
                            <span class="n">k</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">angles</span><span class="p">[(</span><span class="n">at1</span><span class="p">,</span><span class="n">at2</span><span class="p">,</span><span class="n">at3</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">angle_length</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                            
                        <span class="c1">#Reading [torsions] section</span>
                        <span class="k">elif</span> <span class="n">torsions</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;More than six parameters given in [torsions] section at line &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">line</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Less than six parameters given in [torsions] section at line &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">line</span><span class="p">)</span>
                            <span class="n">at1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">at2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">at3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">at4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">torsion_length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">radian</span>
                            <span class="n">k</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">torsions</span><span class="p">[(</span><span class="n">at1</span><span class="p">,</span><span class="n">at2</span><span class="p">,</span><span class="n">at3</span><span class="p">,</span><span class="n">at4</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">torsion_length</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                            
                        <span class="c1">#Reading [impropers] section</span>
                        <span class="k">elif</span> <span class="n">impropers</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;More than six parameters given in [impropers] section at line &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">line</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Less than six parameters given in [impropers] section at line &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">line</span><span class="p">)</span>
                            <span class="n">at1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">at2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">at3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">at4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">improper_length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">radian</span>
                            <span class="n">k</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">impropers</span><span class="p">[(</span><span class="n">at1</span><span class="p">,</span><span class="n">at2</span><span class="p">,</span><span class="n">at3</span><span class="p">,</span><span class="n">at4</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">improper_length</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                            
                        <span class="c1">#Reading [planars] section</span>
                        <span class="k">elif</span> <span class="n">planars</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;More than six parameters given in [planars] section at line &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">line</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Less than six parameters given in [planars] section at line &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">line</span><span class="p">)</span>
                            <span class="n">at1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">at2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">at3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">at4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">improper_length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">radian</span>
                            <span class="n">k</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">planars</span><span class="p">[(</span><span class="n">at1</span><span class="p">,</span><span class="n">at2</span><span class="p">,</span><span class="n">at3</span><span class="p">,</span><span class="n">at4</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">improper_length</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                        
                        <span class="c1">#Reading [contacts] section</span>
                        <span class="k">elif</span> <span class="n">contacts</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;More than four parameters given in [contacts] section at line &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">line</span><span class="p">)</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Less than four parameters given in [contacts] section at line &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">line</span><span class="p">)</span>
                            <span class="n">at1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">at2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">contact_length</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">nanometer</span>
                            <span class="n">k</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">[(</span><span class="n">at1</span><span class="p">,</span><span class="n">at2</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">contact_length</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                            
                    <span class="c1">#Select which section is being reading by changing its boolean to 1</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[bonds]&#39;</span><span class="p">):</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading bond parameters&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">bonds</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
                        <span class="n">bonds</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[angles]&#39;</span><span class="p">):</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading angle parameters&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">angles</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
                        <span class="n">angles</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[torsions]&#39;</span><span class="p">):</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading torsion parameters&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">torsions</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
                        <span class="n">torsions</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[impropers]&#39;</span><span class="p">):</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading improper parameters&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">impropers</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
                        <span class="n">impropers</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[planars]&#39;</span><span class="p">):</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading planar parameters&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">planars</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
                        <span class="n">planars</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[contacts]&#39;</span><span class="p">):</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reading native contact parameters&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
                        <span class="n">contacts</span> <span class="o">=</span> <span class="kc">True</span>
                        
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done reading Forcefield paramters&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="system.setCAMassPerResidueType"><a class="viewcode-back" href="../../index.html#core.models.system.setCAMassPerResidueType">[docs]</a>    <span class="k">def</span> <span class="nf">setCAMassPerResidueType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the masses of the alpha carbon atoms to the average mass</span>
<span class="sd">        of its amino acid residue. </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">aa_masses</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;ALA&#39;</span><span class="p">:</span>  <span class="mf">71.0</span><span class="p">,</span> <span class="s1">&#39;ARG&#39;</span><span class="p">:</span> <span class="mf">157.0</span><span class="p">,</span> <span class="s1">&#39;ASN&#39;</span><span class="p">:</span> <span class="mf">114.0</span><span class="p">,</span>
                     <span class="s1">&#39;ASP&#39;</span><span class="p">:</span> <span class="mf">114.0</span><span class="p">,</span> <span class="s1">&#39;CYS&#39;</span><span class="p">:</span> <span class="mf">103.0</span><span class="p">,</span> <span class="s1">&#39;GLU&#39;</span><span class="p">:</span> <span class="mf">128.0</span><span class="p">,</span>
                     <span class="s1">&#39;GLN&#39;</span><span class="p">:</span> <span class="mf">128.0</span><span class="p">,</span> <span class="s1">&#39;GLY&#39;</span><span class="p">:</span>  <span class="mf">57.0</span><span class="p">,</span> <span class="s1">&#39;HIS&#39;</span><span class="p">:</span> <span class="mf">138.0</span><span class="p">,</span>
                     <span class="s1">&#39;ILE&#39;</span><span class="p">:</span> <span class="mf">113.0</span><span class="p">,</span> <span class="s1">&#39;LEU&#39;</span><span class="p">:</span> <span class="mf">113.0</span><span class="p">,</span> <span class="s1">&#39;LYS&#39;</span><span class="p">:</span> <span class="mf">128.0</span><span class="p">,</span>
                     <span class="s1">&#39;MET&#39;</span><span class="p">:</span> <span class="mf">131.0</span><span class="p">,</span> <span class="s1">&#39;PHE&#39;</span><span class="p">:</span> <span class="mf">147.0</span><span class="p">,</span> <span class="s1">&#39;PRO&#39;</span><span class="p">:</span>  <span class="mf">97.0</span><span class="p">,</span> 
                     <span class="s1">&#39;SER&#39;</span><span class="p">:</span>  <span class="mf">87.0</span><span class="p">,</span> <span class="s1">&#39;THR&#39;</span><span class="p">:</span> <span class="mf">101.0</span><span class="p">,</span> <span class="s1">&#39;TRP&#39;</span><span class="p">:</span> <span class="mf">186.0</span><span class="p">,</span> 
                     <span class="s1">&#39;TYR&#39;</span><span class="p">:</span> <span class="mf">163.0</span><span class="p">,</span> <span class="s1">&#39;VAL&#39;</span><span class="p">:</span>  <span class="mf">99.0</span><span class="p">}</span>
        
        <span class="n">masses</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">residues</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">aa_masses</span><span class="p">:</span>
                <span class="n">masses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aa_masses</span><span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">setParticlesMasses</span><span class="p">(</span><span class="n">masses</span><span class="p">)</span></div>
        
<span class="c1">#TODO:     def setMassPerAtomType(self):</span>
        
    <span class="c1">## User-hidden functions ##</span>
    
    <span class="k">def</span> <span class="nf">_setParameters</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        General function to set up or change force field parameters.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        term : dict</span>
<span class="sd">            Dictionary object containing the set of degrees of freedom</span>
<span class="sd">            (DOF) to set up attributes to (e.g. bonds attribute)</span>
<span class="sd">            </span>
<span class="sd">        parameters : integer or float or list</span>
<span class="sd">            Value(s) for the specific forcefield parameters. If integer</span>
<span class="sd">            or float, sets up the same value for all the DOF in terms. If </span>
<span class="sd">            list, sets a unique parameter for each DOF. </span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        
        <span class="c1">#Set constant parameter for each item in FF term</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">term</span><span class="p">:</span>
                <span class="n">term</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span><span class="p">[</span><span class="n">item</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">parameters</span><span class="p">,)</span>
                
        <span class="c1">#Set unique parameter for each item in FF term</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">term</span><span class="p">):</span>
                <span class="n">term</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span><span class="p">[</span><span class="n">item</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">parameters</span><span class="p">[</span><span class="n">i</span><span class="p">],)</span>
    
    <span class="k">def</span> <span class="nf">_checkContactFileType</span><span class="p">(</span><span class="n">contact_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to check the format of the input contact file. </span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        contact_file : string</span>
<span class="sd">            Name of the input contact file. </span>
<span class="sd">            </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">contact_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cf</span><span class="p">:</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">cf</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)]</span>
            <span class="n">lengths</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lengths</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;smog&#39;</span>
            <span class="k">elif</span> <span class="n">lengths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;2column&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, "Martin Floor, Kengjie Li".
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>